# Introduction

NetBird’s Network Flow Logs feature provides a high-level view of traffic flows between network peers and resources.
It captures connection events on the client (peer) side – for example, when peer A connects to peer B –
allowing administrators to observe how devices communicate across the NetBird network​.
The primary purpose of flow logging is to help network admins monitor network activity,
detect unusual or unauthorized connections, and troubleshoot connectivity issues in their NetBird mesh VPN​.
Unlike packet capture, flow logs record metadata about the traffic (addresses, ports, timestamps, etc.) rather than the contents,
preserving privacy while still giving useful insight​.

By focusing on client-side events, NetBird’s flow logs show what each peer is doing on the network.
This includes which peers or services it is contacting, over which protocols, and when.
Network Flow Logs are especially useful for verifying that access control policies are working as expected (e.g. confirming that a peer could reach an allowed resource,
or that blocked traffic wasn’t forwarded).
In essence, they provide an audit trail of network connections in your NetBird environment,
helping administrators ensure the network is being used according to policy and to quickly identify
any anomalies or needed configuration changes.

# Data Collected on Peers

When enabled, a NetBird peer will record metadata for each network flow that it participates in. The data collected typically includes:

* Timestamp/Duration: When the flow started and ended (or how long it lasted).
* Source and Destination IP Addresses: The IP of the peer (source) and the IP of the remote endpoint (destination). For peer-to-peer traffic, these will be the NetBird network IPs (e.g. 100.x.x.x addresses of each peer). For traffic to an external resource (like a private server or subnet), the destination might be an IP in that remote network​.
* Source and Destination Ports: The network ports used by the connection (for TCP/UDP flows). ICMP flows will be identified by ICMP type rather than ports​.
* Protocol: The protocol of the traffic, such as TCP, UDP, or ICMP​.
* Volume of Data – The amount of data transferred, often measured in number of packets and bytes sent/received for the duration of the flow​.(This is sometimes referred to as packet/byte counting.)
**[CHECK] Add all fields**

Crucially, only metadata is logged, not the actual payload of the packets.
NetBird does not record contents of communications – for example, it might log that a peer made an HTTPS connection
to an IP, but it will not log any usernames, passwords, or data exchanged inside that connection.
This means sensitive information within the traffic remains private​.
In addition, certain types of traffic are excluded from logging by default for privacy and noise reduction.
For instance, DNS query traffic is not collected by default.
Similarly, NetBird’s own control traffic (management, keepalives, etc.) is not recorded in flow logs.
The focus is on user-initiated network flows relevant to your access policies.

# Kernel Mode vs Userspace Mode

NetBird leverages WireGuard for its tunneling, and it can operate in two modes on client devices: kernel mode or userspace mode.
In kernel mode, NetBird utilizes the operating system’s WireGuard kernel module (when available) for handling encryption and routing.
This offers very efficient performance with low overhead, as the heavy lifting is done inside the OS kernel.
NetBird is designed to take advantage of kernel-mode WireGuard whenever possible for direct peer-to-peer connections​.
If the kernel module isn’t available or if the platform doesn’t support it (for example, Windows, or certain BSD-based systems),
NetBird falls back to a userspace implementation of WireGuard (running in the NetBird agent process).
Userspace mode may introduce slightly higher CPU usage or latency since packets are handled in the application layer rather than the kernel,
but it ensures compatibility across all environments.

**[CHECK] We need to explain what's the how the flow logs differ in kernel mode vs userspace mode.**

# Flow Log Retention

NetBird clients do not store Network Flow Logs indefinitely; instead, they follow a retention policy to
balance storage use and privacy. By default, flow log data is retained for 24 hours on the management system,
after which older records are automatically deleted.

However, while in experimental mode, logs are retained for 48 hours, providing an extended window for reviewing recent
network activity and troubleshooting issues. This retention policy helps administrators monitor network behavior
while preventing excessive log growth on the client.

# Scenarios and Use Cases

This section outlines common scenarios in which Network Flow Logs are useful, explaining what administrators can glean in each case.
We’ll also illustrate some scenarios with examples and screenshots of log data where applicable.

## 1. Peer-to-Peer Connections

When two NetBird peers communicate directly, a flow log entry is generated on the peer that initiated the connection.
This covers basic peer-to-peer traffic such as one workstation pinging another, an SSH session from one server to another,
or any application data exchanged between two peers over the NetBird VPN.
The log will show the source peer’s NetBird IP and the destination peer’s NetBird IP, along with the protocol and ports used.

#### 1.1. Example of a flow log entry for a TCP connection between two peers.
In the above example, a peer with IP < a.b.c.d > opened a TCP connection from source port < e > to another peer at IP < f.g.h.i > on destination port < j >.
The screenshot also indicates the volume of data: txBytes and rxBytes (bytes transmitted and received) for that flow.
Initiator peer would log the flow it as an outgoing connection.\
**[CHECK] Add screenshot**

#### 1.2. Example of a flow log entry for an UDP connection between two peers.

In the case of UDP traffic between peers (for example, a UDP-based service), the flow log will similarly record the source/dest IPs and ports and label the protocol as UDP.
UDP flows might not have a clear “end” (since UDP is connectionless), so they may be reported with a duration corresponding to the period of activity or on a rolling interval.\
**[CHECK] Add screenshot**


#### 1.3. Example of a flow log entry for an ICMP connection between two peers.

ICMP flows (like a ping) will appear with protocol ICMP in the logs. For a ping, you’d see the two peers’ IPs and the fact it was ICMP;
if packet/byte counting is on, you might see a couple of packets (an echo request and reply) recorded.\
**[CHECK] Add screenshot**


Peer-to-peer log entries help answer questions like:
Did peer A communicate with peer B? Over which protocol and port? How much data was exchanged?
For instance, if a developer says they couldn’t reach a service on another machine,
an admin can check the flow logs on the source peer to see if a TCP flow to the destination was attempted or established.
If the log shows the connection and bytes flowing, the network was fine and the issue might be elsewhere; if no flow is logged,
the traffic never left the source peer (perhaps due to ACL blocking or a local issue).
In summary, peer-to-peer flow logs give you a timestamped record of direct interactions between NetBird-connected machines,
whether it’s successful SSH sessions, failed ping attempts, or any other IP traffic between peers​

## 2. Peer-to-Resource Connections

When a NetBird peer connects to a resource outside the NetBird network (e.g. a private server, a cloud service, or a remote subnet), ...

#### 2.1. Peer-To-Host Connection

This scenario involves a NetBird peer accessing a specific host resource on an internal network, via a routing peer.
In NetBird, you can define resources (in Access Control) that are single hosts (single IP addresses) which a peer should be allowed to reach.
For example, you might have an on-premises database server at IP < a.b.c.d > that is not itself running NetBird,
but one of your NetBird peers (say, Peer B) is in that network and can route traffic to it.
Another peer (Peer A) somewhere else is granted access to that host through NetBird.
When Peer A tries to connect (e.g. HTTP on port 80) to the host resource < a.b.c.d > the traffic will go through Peer B
(which acts as a routing peer for that resource).

Flow logs are extremely useful here to understand each step:

* On Peer A’s log, you would see an outgoing flow with destination < a.b.c.d >:80 (for example) over TCP.
The source would be Peer A’s NetBird IP and source port, destination the host’s IP and port 80.
This confirms that Peer A attempted to reach the server.
* **[CHECK]** On Peer B’s log, you would likely see two related flows: one coming from Peer A
(source Peer A’s NB IP to Peer B’s NB IP) and one going out to the server
(source Peer B’s LAN IP to < a.b.c.d > on port 80). Peer B essentially bridges the two networks,
so it sees an incoming encrypted flow and forwards the traffic internally.
NetBird’s flow logging on Peer B can capture the incoming portion (the NetBird tunnel from Peer A)
and the forwarded portion (the LAN traffic to the host).

Using these logs, an admin can verify that the traffic is indeed passing through:
For instance, if Peer A reports a flow to < a.b.c.d > but the server isn’t responding,
you could check Peer B’s logs to ensure it forwarded the traffic. If Peer B’s log shows the flow from Peer A but
no flow out to < a.b.c.d >, that might indicate a routing issue on Peer B
(maybe IP forwarding is disabled or firewall on Peer B blocked it).
On the other hand, if Peer B’s log shows it forwarded to < a.b.c.d >, then the issue might be at the server itself.
Flow logs thus help pinpoint where a breakdown occurs in peer-to-resource scenarios.

Another example: imagine DNS is disabled on a printer, and a user’s laptop (Peer A) tries to ping the printer’s IP
via a NetBird routing peer. The logs on Peer A would show an ICMP flow to the printer’s IP;
the routing peer’s logs would show the traffic coming from the laptop and going to the printer.
If the ping fails, you could see whether the flow reached the printer or not.
All of this without capturing packets – the flow records give a concise summary of what happened.
In summary, for peer-to-host resource events, look at the initiating peer’s log for an outbound flow to the host’s IP,
and the routing peer’s log for the corresponding transit.
These flows confirm that NetBird is correctly carrying traffic to specific single-IP resources in your network.

#### 2.2. Peer-To-Subnet Connection

Similar to the above, this scenario deals with a peer accessing an entire subnet (range of IPs) via a routing peer.
NetBird allows administrators to define network routes (or the newer “Networks” feature) where a Linux peer acts as a gateway to a subnet (for example, an office LAN 10.0.5.0/24).
A common use case is site-to-site connectivity or allowing remote peers to access a whole VLAN or VPC through one NetBird node.

In a peer-to-subnet case, the flow logs will show when a peer communicates with any IP in the target subnet:

* On the client (peer) side, an outgoing flow entry will appear whenever it sends traffic to an IP within the allowed subnet. For instance, if Peer A (remote laptop) connects to 10.0.5.100 (an internal server in the subnet), Peer A’s logs will list a flow with destination 10.0.5.100 (and whatever port/protocol).
* **[CHECK]** On the routing peer’s side (the peer that has access to that subnet), you’ll again see flows coming from Peer A’s NetBird IP to the routing peer (NetBird IP) and flows from the routing peer out to the 10.0.5.x address.


#### 2.3. Peer-To-Domain Connection

## 3. Site-to-Site Connections

When two NetBird networks are connected via a site-to-site tunnel, flow logs can help administrators monitor traffic between the two networks.
...

# Enabling and Disabling Flow Logs

# Enabling and Disabling Packet Counting

# Privacy and Security Considerations

# Conclusion



