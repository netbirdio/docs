import { Note, Warning } from '@/components/mdx'

# Connect Office Networks

This guide helps IT administrators set up secure remote access to office resources and connect multiple office locations.

## What You'll Achieve

After following this guide, you'll be able to:
- Enable remote workers to access office resources (VPN-to-Site)
- Allow office systems to reach remote workers (Site-to-VPN)
- Connect branch offices to headquarters (Site-to-Site)

## Prerequisites

- A [NetBird account](https://app.netbird.io/)
- Admin access to office network infrastructure
- A server or VM at each office location to serve as the routing peer

## Scenario 1: Remote Worker Access (VPN-to-Site)

The most common business scenario: employees need to access office resources while working remotely.

### Step 1: Deploy a Routing Peer at the Office

Choose an always-on server at your office. This can be:
- A dedicated Linux VM
- A Windows Server
- A Docker container on an existing server

**Install NetBird:**

```bash
# Linux
curl -fsSL https://pkgs.netbird.io/install.sh | sh

# Windows (PowerShell as Administrator)
Invoke-WebRequest -Uri "https://pkgs.netbird.io/install.ps1" -OutFile "install.ps1"; .\install.ps1
```

**Connect using a setup key:**

1. In the NetBird dashboard, go to **Setup Keys**
2. Create a reusable key for server deployments
3. Run: `netbird up --setup-key YOUR_SETUP_KEY`

### Step 2: Create a Network for Office Resources

1. Go to **Networks** in the dashboard
2. Click **Add Network** and name it "Office LAN"
3. Click **Add Resource** and enter your office subnet (e.g., `10.0.0.0/24`)
4. Assign it to a group like "office-resources"

### Step 3: Add the Routing Peer

1. In the Office LAN network, click **Add Routing Peer**
2. Select your office server
3. Click **Add Routing Peer**

### Step 4: Create Access Policies

1. Go to **Access Control > Policies**
2. Create a policy:
   - Name: "Remote Worker Office Access"
   - Source: "Remote Workers" group (or appropriate user group)
   - Destination: "office-resources"
   - Protocol: Choose based on needs (TCP for most apps, All for full access)

### Step 5: Onboard Remote Workers

Distribute NetBird to remote workers:

1. Create setup keys for employee devices
2. Have employees install NetBird and connect
3. Add employees to the "Remote Workers" group

Employees can now access office resources from any location.

---

## Scenario 2: Office Systems Reaching Remote Workers (Site-to-VPN)

Some scenarios require office systems to initiate connections to remote workers (monitoring, management tools, etc.).

<Note>
Site-to-VPN requires Network Routes because the Networks feature doesn't support clientless devices initiating connections.
</Note>

### Step 1: Set Up the Routing Peer

Follow Scenario 1, Step 1 to deploy a routing peer at the office.

### Step 2: Create a Network Route for the Office Network

1. Go to **Network Routes**
2. Click **Add Route**
3. Enter the office subnet (e.g., `10.0.0.0/24`)
4. Select your routing peer
5. Enable **Masquerade**
6. Click **Save**

### Step 3: Configure the Office System

On the office system that needs to reach remote workers, add a route to the NetBird network:

```bash
# Route to NetBird network through the routing peer
sudo ip route add 100.64.0.0/10 via 10.0.0.50
```

Where `10.0.0.50` is the routing peer's office IP.

### Step 4: Create Bidirectional Access Policies

Create policies allowing traffic in both directions:

1. Office to remote workers (for initiated connections)
2. Remote workers to office (for responses)

---

## Scenario 3: Branch Office Connectivity (Site-to-Site)

Connect multiple office locations so all devices can communicate.

### Example Setup

- **Headquarters**: `10.0.0.0/24` with routing peer "hq-router"
- **Branch Office**: `10.1.0.0/24` with routing peer "branch-router"

### Step 1: Deploy Routing Peers

Install NetBird on a server at each location. Create dedicated groups for each:
- "hq-routing-peers" for headquarters
- "branch-routing-peers" for branch office

### Step 2: Create Network Routes

**For headquarters:**
1. Go to **Network Routes**
2. Add route: `10.0.0.0/24`
3. Routing peer: "hq-router"
4. Enable Masquerade
5. Optionally add ACL Groups for access control

**For branch office:**
1. Add route: `10.1.0.0/24`
2. Routing peer: "branch-router"
3. Enable Masquerade
4. Optionally add ACL Groups

### Step 3: Create Access Policies

Create policies allowing the routing peers to communicate:

```
Source: hq-routing-peers → Destination: branch-routing-peers (All protocols)
Source: branch-routing-peers → Destination: hq-routing-peers (All protocols)
```

For route-level access control, also create policies for the ACL Groups if configured.

### Step 4: Configure Network Equipment

**Option A: Router-level routes (recommended)**

Configure your routers to advertise routes to the remote network via DHCP or add static routes:

```
# On HQ router, route to branch through routing peer
10.1.0.0/24 via 10.0.0.50 (hq-router's IP)

# On Branch router, route to HQ through routing peer
10.0.0.0/24 via 10.1.0.50 (branch-router's IP)
```

**Option B: Per-device routes**

Add routes on individual devices that need cross-site access:

```bash
# On HQ device
sudo ip route add 10.1.0.0/24 via 10.0.0.50

# On Branch device
sudo ip route add 10.0.0.0/24 via 10.1.0.50
```

### Step 5: Test Connectivity

From a device at headquarters:

```bash
ping 10.1.0.1  # Branch router
ping 10.1.0.100  # Branch server
```

---

## Best Practices for Business Deployments

### Access Control

- Create specific groups for different access levels (IT Admin, Sales, Engineering)
- Use protocol restrictions (e.g., only allow RDP to certain servers)
- Implement time-limited setup keys for contractor access

### High Availability

For critical connections, consider:
- Multiple routing peers at each location
- Monitoring routing peer health
- Automatic failover configuration

### Security

- Enable [Posture Checks](/manage/access-control/posture-checks) to verify device compliance
- Use [Activity Logging](/manage/activity) to audit access
- Implement MFA through your identity provider

## Troubleshooting

**Remote workers can't access office resources:**
1. Verify the routing peer is online and connected
2. Check access policies include the user's group
3. Ensure the routing peer can reach office resources locally

**Branch office connectivity issues:**
1. Confirm both routing peers show as connected in the dashboard
2. Verify static routes are configured correctly
3. Check firewall rules aren't blocking traffic

**Slow performance:**
1. Check routing peer placement—it should have good network connectivity
2. Consider enabling [lazy connections](/manage/peers/lazy-connection) for large deployments
3. Review network route priorities if multiple routes exist

For advanced configuration including masquerade options and detailed access control, see [Advanced Configuration](/manage/site-to-site/advanced-configuration).
