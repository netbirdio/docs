import {Note} from "@/components/mdx";

# Authentik

[Authentik](https://goauthentik.io) is an open-source identity provider focused on flexibility and security. It serves as a self-hosted alternative to commercial solutions like Okta and Auth0, providing single sign-on (SSO), multi-factor authentication (MFA), access policies, user management, and support for SAML and OIDC protocols.

## Management Setup (Recommended)

Add Authentik as an external IdP directly in the NetBird Management Dashboard. This is the simplest approach and recommended for most deployments.

### Prerequisites

- NetBird self-hosted with embedded IdP enabled
- Authentik instance with admin access

### Step 1: Create OAuth2/OpenID Provider in Authentik

1. Navigate to Authentik admin interface
2. Click **Applications** on the left menu, then click **Providers**
3. Click **Create** to create a new provider
4. Select **OAuth2/OpenID Provider** and click **Next**

<p>
    <img src="/docs-static/img/selfhosted/identity-providers/self-hosted/authentik/authentik-new-provider-type.png" alt="Select provider type" className="imagewrapper-big"/>
</p>

5. Fill in the form with the following values:
   - **Name**: `NetBird`
   - **Authentication Flow**: `default-authentication-flow (Welcome to authentik!)`
   - **Authorization Flow**: `default-provider-authorization-explicit-consent (Authorize Application)`
   - **Client type**: `Confidential`
   - **Redirect URIs/Origins**: Leave empty for now (you'll add this after adding the identity provider in NetBird)
   - **Signing Key**: Select any cert present, e.g., `authentik Self-signed Certificate`

6. Click **Finish**
7. Note the **Client ID** and **Client Secret**

### Step 2: Create Application in Authentik

1. Click **Applications** on the left menu, then click **Applications**
2. Click **Create** to create a new application
3. Fill in the form:
   - **Name**: `NetBird`
   - **Slug**: `netbird`
   - **Provider**: Select the `NetBird` provider you created
4. Click **Create**

<p>
    <img src="/docs-static/img/selfhosted/identity-providers/self-hosted/authentik/authentik-new-application.png" alt="Create application" className="imagewrapper-big"/>
</p>

### Step 3: Add Identity Provider in NetBird

1. Log in to your NetBird Dashboard
2. Navigate to **Settings** → **Identity Providers**
3. Click **Add Identity Provider**
4. Fill in the fields:

| Field | Value |
|-------|-------|
| Type | Generic OIDC |
| Name | Authentik (or your preferred display name) |
| Client ID | From Authentik provider |
| Client Secret | From Authentik provider |
| Issuer | `https://authentik.example.com/application/o/netbird/` |

5. Click **Save**

### Step 4: Configure Redirect URI

After saving, NetBird displays the **Redirect URL**. Copy this URL and add it to your Authentik provider:

1. Return to Authentik admin → **Providers** → **NetBird**
2. Click **Edit**
3. Under **Redirect URIs/Origins**, add the redirect URL from NetBird
4. Click **Update**

### Step 5: Test the Connection

1. Log out of NetBird Dashboard
2. On the login page, you should see an "Authentik" button
3. Click it and authenticate with your Authentik credentials
4. You should be redirected back to NetBird and logged in

---

## Standalone Setup (Advanced)

Use Authentik as your primary identity provider instead of NetBird's embedded IdP. This option gives you full control over authentication and user management, is recommended for experienced Authentik administrators as it also requires additional setup and ongoing maintenance.

For most deployments, the [embedded IdP](/selfhosted/identity-providers/local) is the simpler choice — it's built into NetBird, fully integrated, and requires minimal configuration to get started. For this implementation, go back up to the [Management Setup (Recommended)](#management-setup-recommended) section above.

For detailed instructions on the standalone setup, see the [Authentik SSO with NetBird Self-Hosted (Advanced)](/selfhosted/identity-providers/advanced/authentik) documentation.

<Note>
If you prefer not to self-host an Identity and Access Management solution, you could use a managed alternative like [Auth0](/selfhosted/identity-providers/managed/auth0).
</Note>

---

## Troubleshooting

### "Invalid redirect URI" error

- Ensure the redirect URI exactly matches what NetBird provides
- Copy the exact URL from the success modal

### Authentication fails silently

- Verify a signing key is selected in the provider configuration
- Check that the application is linked to the correct provider

---

## Related Resources

- [Authentik Documentation](https://goauthentik.io/docs/)
- [Embedded IdP Overview](/selfhosted/identity-providers/local)