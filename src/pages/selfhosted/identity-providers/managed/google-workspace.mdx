import {Note} from "@/components/mdx";

# Google Workspace SSO with NetBird Self-Hosted

Use Google accounts for authentication with NetBird. This supports both personal Google accounts and Google Workspace (formerly G Suite) organizations.

## Management Setup (Recommended)

Add Google as an external IdP directly in the NetBird Management Dashboard. This is the simplest approach and recommended for most deployments.

### Prerequisites

- NetBird self-hosted with embedded IdP enabled
- Access to [Google Cloud Console](https://console.cloud.google.com/)

### Step 1: Start Creating OAuth Credentials

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Select or create a project
3. Navigate to **APIs & Services** → **Credentials**
4. Click **Create Credentials** → **OAuth client ID**

<p>
    <img src="/docs-static/img/selfhosted/identity-providers/managed/google-workspace/1_0auth-client-id-google.png" alt="OAuth client ID" className="imagewrapper-big"/>
</p>

5. If prompted, configure the OAuth consent screen first:
   - Choose **Internal** (for Workspace) or **External** (for any Google account)
   - Fill in required fields (app name, support email)
   - Add scopes: `email`, `profile`, `openid`
   - Save and continue
6. Back in Credentials, create the OAuth client:
   - **Application type**: `Web application`
   - **Name**: `NetBird`
   - Leave redirect URIs empty for now (you'll add this in Step 3)

7. **Don't click Create yet** — keep this tab open and proceed to Step 2

### Step 2: Get Redirect URL from NetBird

1. Open a new tab or window and log in to your NetBird Dashboard
2. Navigate to **Settings** → **Identity Providers**
3. Click **Add Identity Provider**
4. Fill in the fields:

| Field | Value |
|-------|-------|
| Type | Google |
| Name | Google (or your preferred display name) |
| Client ID | From Google Cloud Console (will fill after Step 3) |
| Client Secret | From Google Cloud Console (will fill after Step 3) |

5. **Copy the Redirect URL** that NetBird displays (but don't click **Add Provider** yet)

<p>
    <img src="/docs-static/img/selfhosted/identity-providers/managed/google-workspace/2_copy-redirect-google.png" alt="Copy redirect URL" className="imagewrapper-big"/>
</p>

### Step 3: Complete Google OAuth Client Setup

1. Return to the Google Cloud Console tab
2. Under **Authorized redirect URIs**, click **Add URI**
3. Paste the redirect URL you copied from NetBird

<p>
    <img src="/docs-static/img/selfhosted/identity-providers/managed/google-workspace/3_paste-uri-google.png" alt="Paste URI" className="imagewrapper-big"/>
</p>

4. Click **Create**
5. Note the **Client ID** and **Client Secret** — you'll need these for Step 4

<p>
    <img src="/docs-static/img/selfhosted/identity-providers/managed/google-workspace/4_0auth-client-created-google.png" alt="OAuth client created" className="imagewrapper-big"/>
</p>

### Step 4: Complete NetBird Setup

1. Return to the NetBird tab
2. Fill in the **Client ID** and **Client Secret** from Step 3

<p>
    <img src="/docs-static/img/selfhosted/identity-providers/managed/google-workspace/5_netbird-complete-google.png" alt="NetBird complete configuration" className="imagewrapper-big"/>
</p>

3. Click **Add Provider**

### Step 5: Test the Connection

1. Log out of NetBird Dashboard
2. On the login page, you should see a "Google" button
3. Click it and sign in with your Google account
4. You should be redirected back to NetBird and logged in. Unless your user approval setting were changed you will need to log back into your local admin account to approve the user.

### Restricting to Google Workspace Domains

To limit authentication to specific Google Workspace domains:

1. Go to **APIs & Services** → **OAuth consent screen**
2. Under **User type**, select **Internal** (Workspace only)
3. For external apps, verify your domain to restrict access

<Note>
Domain restrictions are configured in Google Cloud Console, not in NetBird.
</Note>

---

## Standalone Setup (Advanced)

Use Google Workspace as your primary identity provider instead of NetBird's embedded IdP. This option gives you full control over authentication and user management, is recommended for experienced Google Workspace administrators as it also requires additional setup and ongoing maintenance.

For most deployments, the [embedded IdP](/selfhosted/identity-providers/local) is the simpler choice — it's built into NetBird, fully integrated, and requires minimal configuration to get started. For this implementation, go back up to the [Management Setup (Recommended)](#management-setup-recommended) section above.

For detailed instructions on the standalone setup, see the [Google Workspace SSO with NetBird Self-Hosted (Legacy)](/selfhosted/identity-providers/managed/advanced/google-workspace) documentation.

<Note>
If you prefer to have full control over authentication, consider self-hosted alternatives like [PocketID](/selfhosted/identity-providers/pocketid).
</Note>

---

## Troubleshooting

### "Access blocked" error

- Ensure OAuth consent screen is configured correctly
- For external apps, you may need to submit for verification or add test users
- Check that required scopes are added

### "Invalid redirect URI" error

- Verify the redirect URI exactly matches what's in Google Cloud Console
- Check for trailing slashes or HTTP vs HTTPS mismatches
- Google is case-sensitive for redirect URIs

### Users from wrong domain signing in

- For Workspace, use **Internal** user type in OAuth consent screen
- Verify domain restrictions in consent screen settings

---

## Related Resources

- [Google Cloud Console](https://console.cloud.google.com/)
- [Google OAuth 2.0 Documentation](https://developers.google.com/identity/protocols/oauth2)
- [Google Workspace Admin Console](https://admin.google.com/)
- [Embedded IdP Overview](/selfhosted/identity-providers/local)