import {Note, Warning} from "@/components/mdx";
import {Properties, Property} from "@/components/mdx";

# Configuration Files Reference

This page provides a comprehensive reference for all configuration files used when self-hosting NetBird. Understanding these files helps you customize your deployment, troubleshoot issues, and integrate with existing infrastructure.

<Note>
Most configuration files are **generated automatically** by the `getting-started.sh` or `configure.sh` scripts. Modifying files directly is only necessary for advanced customization. Changes to `setup.env` require re-running the configuration script to take effect.
</Note>

## Overview

A standard NetBird self-hosted deployment uses the following configuration files:

| File | Purpose | Generated By |
|------|---------|--------------|
| `docker-compose.yml` | Service definitions and orchestration | `getting-started.sh` / `configure.sh` |
| `management.json` | Core management server configuration | `getting-started.sh` / `configure.sh` |
| `relay.env` | Relay server environment variables (includes STUN configuration) | `getting-started.sh` |
| `dashboard.env` | Dashboard UI configuration | `getting-started.sh` |
| `Caddyfile` | Reverse proxy configuration (when using built-in Caddy) | `getting-started.sh` |

### File Locations

After running the installation script, configuration files are located in the directory where you ran the script (typically `~/netbird/` or the current working directory):

```
./
├── docker-compose.yml
├── management.json
├── relay.env
├── dashboard.env
└── Caddyfile          # Only when using built-in Caddy
```

---

## docker-compose.yml

The Docker Compose file defines all NetBird services, their dependencies, networking, and volumes.

### Services Overview

| Service | Image | Default Port | Description |
|---------|-------|--------------|-------------|
| `dashboard` | `netbirdio/dashboard` | 80, 443 | Web UI for managing NetBird |
| `management` | `netbirdio/management` | 80 | Core API, peer coordination, and embedded IdP |
| `signal` | `netbirdio/signal` | 80, 10000 | WebRTC signaling for peer connections |
| `relay` | `netbirdio/relay` | 80, 3478/udp | Relay server for NAT traversal with embedded STUN |
| `caddy` | `caddy` | 80, 443 | Reverse proxy (optional, built-in setup) |

<Note>
The relay service includes an embedded STUN server, eliminating the need for a separate coturn container. STUN functionality is enabled via the `NB_ENABLE_STUN` environment variable in `relay.env`.
</Note>

### Default Settings

The compose file includes these defaults applied to all services:

```yaml
x-default: &default
  restart: 'unless-stopped'
  logging:
    driver: 'json-file'
    options:
      max-size: '500m'
      max-file: '2'
```

### Dashboard Service

The dashboard provides the web interface for NetBird management.

```yaml
dashboard:
  image: netbirdio/dashboard:latest
  ports:
    - 80:80
    - 443:443
  environment:
    - NETBIRD_MGMT_API_ENDPOINT=https://netbird.example.com
    - NETBIRD_MGMT_GRPC_API_ENDPOINT=https://netbird.example.com
    - AUTH_AUDIENCE=netbird-dashboard
    - AUTH_CLIENT_ID=netbird-dashboard
    - AUTH_AUTHORITY=https://netbird.example.com/oauth2
    - USE_AUTH0=false
    - AUTH_SUPPORTED_SCOPES=openid profile email groups
    - AUTH_REDIRECT_URI=/nb-auth
    - AUTH_SILENT_REDIRECT_URI=/nb-silent-auth
    - NGINX_SSL_PORT=443
    - LETSENCRYPT_DOMAIN=netbird.example.com
    - LETSENCRYPT_EMAIL=admin@example.com
  volumes:
    - netbird-letsencrypt:/etc/letsencrypt/
```

<Properties>
  <Property name="NETBIRD_MGMT_API_ENDPOINT" type="string">
    Full URL to the Management API endpoint. Used for REST API calls from the dashboard.
  </Property>
  <Property name="NETBIRD_MGMT_GRPC_API_ENDPOINT" type="string">
    Full URL to the Management gRPC endpoint. Usually the same as the API endpoint.
  </Property>
  <Property name="AUTH_AUDIENCE" type="string">
    OAuth2 audience for token validation. Default: `netbird-dashboard`
  </Property>
  <Property name="AUTH_CLIENT_ID" type="string">
    OAuth2 client ID for the dashboard application.
  </Property>
  <Property name="AUTH_AUTHORITY" type="string">
    OAuth2 issuer URL. For embedded IdP: `https://your-domain/oauth2`
  </Property>
  <Property name="USE_AUTH0" type="boolean">
    Set to `true` if using Auth0 as the identity provider. Default: `false`
  </Property>
  <Property name="AUTH_SUPPORTED_SCOPES" type="string">
    Space-separated OAuth2 scopes. Default: `openid profile email groups`
  </Property>
  <Property name="AUTH_REDIRECT_URI" type="string">
    OAuth2 redirect URI path. Default: `/nb-auth`
  </Property>
  <Property name="AUTH_SILENT_REDIRECT_URI" type="string">
    Silent authentication redirect URI. Default: `/nb-silent-auth`
  </Property>
  <Property name="NGINX_SSL_PORT" type="number">
    HTTPS port for the dashboard. Default: `443`
  </Property>
  <Property name="LETSENCRYPT_DOMAIN" type="string">
    Domain for Let's Encrypt certificate. Set to `none` to disable.
  </Property>
  <Property name="LETSENCRYPT_EMAIL" type="string">
    Email for Let's Encrypt registration and renewal notices.
  </Property>
</Properties>

### Management Service

The management service is the core of NetBird, handling peer registration, authentication, and network coordination.

```yaml
management:
  image: netbirdio/management:latest
  depends_on:
    - dashboard
  volumes:
    - netbird-mgmt:/var/lib/netbird
    - netbird-letsencrypt:/etc/letsencrypt:ro
    - ./management.json:/etc/netbird/management.json
  ports:
    - 33073:443
  command: [
    "--port", "443",
    "--log-file", "console",
    "--log-level", "info",
    "--disable-anonymous-metrics=false",
    "--single-account-mode-domain=netbird.example.com",
    "--dns-domain=netbird.selfhosted"
  ]
  environment:
    - NETBIRD_STORE_ENGINE_POSTGRES_DSN=
    - NETBIRD_STORE_ENGINE_MYSQL_DSN=
```

#### Command-Line Flags

| Flag | Default | Description |
|------|---------|-------------|
| `--port` | `443` | Internal listening port |
| `--log-file` | `console` | Log output destination |
| `--log-level` | `info` | Log verbosity: `debug`, `info`, `warn`, `error` |
| `--disable-anonymous-metrics` | `false` | Disable anonymous usage metrics |
| `--single-account-mode-domain` | - | Domain for single account mode |
| `--dns-domain` | `netbird.selfhosted` | DNS domain for peer resolution |

### Signal Service

The signal service handles WebRTC signaling for establishing peer-to-peer connections.

```yaml
signal:
  image: netbirdio/signal:latest
  depends_on:
    - dashboard
  volumes:
    - netbird-signal:/var/lib/netbird
    - netbird-letsencrypt:/etc/letsencrypt:ro
  ports:
    - 10000:80
  command: [
    "--cert-file", "/etc/letsencrypt/live/netbird.example.com/fullchain.pem",
    "--cert-key", "/etc/letsencrypt/live/netbird.example.com/privkey.pem",
    "--log-file", "console",
    "--port", "80"
  ]
```

### Relay Service

The relay service provides NAT traversal when direct peer-to-peer connections are not possible. It also includes an embedded STUN server for NAT detection and traversal.

```yaml
relay:
  image: netbirdio/relay:latest
  env_file:
    - ./relay.env
  ports:
    - '80:80'           # Relay WebSocket
    - '3478:3478/udp'   # Embedded STUN server
```

The relay service is configured via the `relay.env` file. See the [relay.env section](#relayenv) for detailed configuration options.

<Properties>
  <Property name="NB_LOG_LEVEL" type="string">
    Log verbosity level. Options: `debug`, `info`, `warn`, `error`. Default: `info`
  </Property>
  <Property name="NB_LISTEN_ADDRESS" type="string">
    Address and port to listen on. Format: `:port`. Default: `:80`
  </Property>
  <Property name="NB_EXPOSED_ADDRESS" type="string">
    Public address for peers to connect. Format: `rel://hostname:port` or `rels://hostname:port` for TLS.
  </Property>
  <Property name="NB_AUTH_SECRET" type="string">
    Shared secret for relay authentication. Must match `management.json` Relay.Secret.
  </Property>
  <Property name="NB_ENABLE_STUN" type="boolean">
    Enable the embedded STUN server. Default: `false`
  </Property>
  <Property name="NB_STUN_PORTS" type="string">
    Comma-separated list of UDP ports for the STUN server. Default: `3478`
  </Property>
</Properties>

### STUN Server (Embedded in Relay)

<Note>
Starting with the current quickstart installation, STUN functionality is **embedded directly in the relay service**. The separate coturn container is no longer used in the default deployment. This simplifies the architecture and reduces the number of containers to manage.
</Note>

The embedded STUN server is enabled by setting `NB_ENABLE_STUN=true` in `relay.env`. The STUN server listens on UDP port 3478 by default.

#### Legacy Coturn Configuration

If you have an existing installation using coturn, or need advanced TURN functionality (such as time-based credentials or TCP relay), you can still use a separate coturn container. See the [advanced self-hosting guide](/selfhosted/selfhosted-guide) for coturn configuration details.

### Volume Configuration

| Volume | Mount Point | Purpose |
|--------|-------------|---------|
| `netbird-mgmt` | `/var/lib/netbird` | Management database and state |
| `netbird-signal` | `/var/lib/netbird` | Signal service data |
| `netbird-letsencrypt` | `/etc/letsencrypt` | TLS certificates |

---

## management.json

The management configuration file controls the core behavior of the NetBird Management service. This is the most complex configuration file.

### Embedded IdP vs External IdP Configuration

The structure of `management.json` varies significantly depending on whether you use the **embedded IdP** (quickstart deployment) or configure identity providers at the **infrastructure level** (advanced deployment).

<Note>
**Most users following the [Quickstart Guide](/selfhosted/selfhosted-quickstart) will have a much simpler `management.json`**. The embedded IdP handles authentication automatically, and many of the sections documented below are not needed.
</Note>

#### Understanding "Embedded IdP"

The term "embedded IdP" refers to NetBird's built-in identity provider system based on DEX. This is **not** a limitation - it is actually the modern, recommended approach that offers several advantages:

**You CAN connect external identity providers with the embedded IdP:**
- **Google Workspace** - Use Google accounts for authentication
- **Microsoft Entra ID (Azure AD)** - Integrate with Microsoft 365 organizations
- **Okta** - Connect your Okta workforce identity
- **Self-hosted Authentik** - Use your own Authentik instance for authentication
- **Any OIDC provider** - Any provider supporting OpenID Connect works with NetBird

**How to add external IdPs with the embedded system:**
1. Go to **Settings → Identity Providers** in the NetBird Dashboard
2. Click **Add Identity Provider**
3. Follow the guided setup for your chosen provider (Google, Okta, self-hosted Authentik, or any other OIDC provider)
4. Users can then authenticate using their existing corporate credentials

This Dashboard-based configuration is simpler, more maintainable, and does not require editing `management.json`.

#### When to use infrastructure-level IdP configuration

The `HttpConfig`, `IdpManagerConfig`, `DeviceAuthorizationFlow`, and `PKCEAuthorizationFlow` sections documented below are for the **legacy advanced deployment method** where:
- You configure the IdP connection directly in `management.json`
- The embedded IdP is disabled
- You manage OAuth2/OIDC settings at the infrastructure level rather than through the UI

This approach is typically only needed for:
- Organizations with specific compliance requirements mandating infrastructure-as-code IdP configuration
- Complex multi-tenant scenarios
- Migrations from older NetBird deployments that predate the Dashboard IdP management feature

**Quickstart deployment (embedded IdP - recommended):**
- Uses the `EmbeddedIdP` section to enable the built-in identity provider
- External IdPs (Google, Okta, self-hosted Authentik, or any other OIDC provider) are added via **Settings → Identity Providers** in the Dashboard
- Sections like `HttpConfig`, `IdpManagerConfig`, `DeviceAuthorizationFlow`, and `PKCEAuthorizationFlow` are **not required** and typically omitted
- Authentication endpoints are automatically configured at `https://your-domain/oauth2/`
- User management is done through the Dashboard UI

**Advanced deployment (infrastructure-level IdP):**
- Does **not** use the `EmbeddedIdP` section
- Requires full configuration of `HttpConfig`, `IdpManagerConfig`, `DeviceAuthorizationFlow`, and `PKCEAuthorizationFlow`
- You must configure your external IdP (Okta, Keycloak, Auth0, etc.) and populate these sections with the appropriate values
- See the [Advanced Self-hosting Guide](/selfhosted/selfhosted-guide) for setup instructions

### Configuration Section Summary

| Section | Quickstart (Embedded IdP) | Advanced (Infrastructure-level IdP) |
|---------|---------------------------|-------------------------------------|
| `Stuns` | Required | Required |
| `TURNConfig` | Optional | Optional |
| `Relay` | Required | Required |
| `Signal` | Required | Required |
| `ReverseProxy` | Optional | Optional |
| `StoreConfig` | Optional | Optional |
| `EmbeddedIdP` | **Required** | Not used |
| `HttpConfig` | Not used (auto-configured) | **Required** |
| `IdpManagerConfig` | Not used | **Required** |
| `DeviceAuthorizationFlow` | Not used (auto-configured) | **Required** |
| `PKCEAuthorizationFlow` | Not used (auto-configured) | **Required** |

<Note>
**Remember:** The "Quickstart (Embedded IdP)" column applies even if you want to use external providers like Google, Okta, self-hosted Authentik, or any other OIDC provider. You can add these through **Settings → Identity Providers** in the Dashboard without changing your `management.json` configuration.
</Note>

### Complete Structure

The structure differs based on your deployment type:

**Quickstart deployment (embedded IdP):**
```json
{
    "Stuns": [...],
    "Relay": {...},
    "Signal": {...},
    "Datadir": "/var/lib/netbird",
    "DataStoreEncryptionKey": "...",
    "EmbeddedIdP": {
        "Enabled": true,
        "Issuer": "https://your-domain/oauth2",
        "DashboardRedirectURIs": [...]
    }
}
```

**Advanced deployment (external IdP):**
```json
{
    "Stuns": [...],
    "TURNConfig": {...},
    "Relay": {...},
    "Signal": {...},
    "ReverseProxy": {...},
    "DisableDefaultPolicy": false,
    "DataStoreEncryptionKey": "...",
    "StoreConfig": {...},
    "HttpConfig": {...},
    "IdpManagerConfig": {...},
    "DeviceAuthorizationFlow": {...},
    "PKCEAuthorizationFlow": {...}
}
```

### Stuns Section

Configures STUN servers used for NAT detection and traversal.

**What does STUN do?**

STUN (Session Traversal Utilities for NAT) helps NetBird peers discover their public IP address and the type of NAT they are behind. This information is essential for establishing direct peer-to-peer connections:

- **NAT type detection** - Determines if peers can connect directly or need relay assistance
- **Public address discovery** - Peers learn their external IP and port, which they share via the signal server
- **Connection optimization** - Enables direct connections when possible, reducing latency and relay load

The embedded STUN server in the relay service (enabled via `NB_ENABLE_STUN=true` in `relay.env`) is typically sufficient for most deployments.

```json
"Stuns": [
    {
        "Proto": "udp",
        "URI": "stun:netbird.example.com:3478",
        "Username": "",
        "Password": null
    }
]
```

<Properties>
  <Property name="Proto" type="string">
    Protocol for STUN communication. Options: `udp`, `tcp`. Default: `udp`
  </Property>
  <Property name="URI" type="string">
    STUN server URI. Format: `stun:hostname:port`
  </Property>
  <Property name="Username" type="string">
    Optional username for authenticated STUN. Usually empty.
  </Property>
  <Property name="Password" type="string | null">
    Optional password for authenticated STUN. Usually `null`.
  </Property>
</Properties>

### TURNConfig Section

Configures TURN servers for relay when direct connections fail.

```json
"TURNConfig": {
    "Turns": [
        {
            "Proto": "udp",
            "URI": "turn:netbird.example.com:3478",
            "Username": "netbird",
            "Password": "your-turn-password"
        }
    ],
    "CredentialsTTL": "12h",
    "Secret": "secret",
    "TimeBasedCredentials": false
}
```

<Properties>
  <Property name="Turns" type="array">
    Array of TURN server configurations.
  </Property>
  <Property name="Turns[].Proto" type="string">
    Protocol: `udp`, `tcp`, or `tls`. Default: `udp`
  </Property>
  <Property name="Turns[].URI" type="string">
    TURN server URI. Format: `turn:hostname:port` or `turns:hostname:port` for TLS.
  </Property>
  <Property name="Turns[].Username" type="string">
    TURN authentication username.
  </Property>
  <Property name="Turns[].Password" type="string">
    TURN authentication password.
  </Property>
  <Property name="CredentialsTTL" type="string">
    Time-to-live for TURN credentials. Format: Go duration (e.g., `12h`, `30m`). Default: `12h`
  </Property>
  <Property name="Secret" type="string">
    Shared secret for time-based credentials (when enabled).
  </Property>
  <Property name="TimeBasedCredentials" type="boolean">
    Enable time-based TURN credentials. Default: `false`
  </Property>
</Properties>

### Relay Section

Configures the NetBird relay server connection for NAT traversal.

**What does the relay service do?**

When two NetBird peers cannot establish a direct WireGuard connection (due to restrictive NATs, firewalls, or network topology), traffic is routed through the relay server. The relay acts as an encrypted intermediary, ensuring connectivity even in challenging network environments.

- **Automatic fallback** - Peers attempt direct connections first; relay is used only when needed
- **End-to-end encryption** - Traffic remains WireGuard-encrypted; the relay cannot read packet contents
- **Credential-based authentication** - The shared secret ensures only authorized peers can use your relay

```json
"Relay": {
    "Addresses": ["rel://netbird.example.com:33080"],
    "CredentialsTTL": "24h",
    "Secret": "your-relay-secret"
}
```

<Properties>
  <Property name="Addresses" type="array">
    Array of relay server addresses. Format: `rel://hostname:port`
  </Property>
  <Property name="CredentialsTTL" type="string">
    Time-to-live for relay credentials. Default: `24h`
  </Property>
  <Property name="Secret" type="string">
    Shared authentication secret. Must match relay server's `NB_AUTH_SECRET`.
  </Property>
</Properties>

<Warning>
The relay secret must be identical in both `management.json` and the relay service environment. A mismatch will cause relay connections to fail.
</Warning>

### Signal Section

Configures the connection to the Signal service for peer-to-peer connection establishment.

**What does the signal service do?**

The signal service facilitates WebRTC signaling between NetBird peers. When two peers want to establish a direct connection, they exchange connection offers, answers, and ICE candidates through the signal server. This coordination enables peers to discover each other and negotiate the optimal connection path.

- **Connection coordination** - Peers exchange network information to establish direct WireGuard tunnels
- **No traffic routing** - Unlike the relay, the signal server only handles connection setup metadata, not actual traffic
- **Persistent connections** - Peers maintain a connection to the signal server to receive incoming connection requests

```json
"Signal": {
    "Proto": "http",
    "URI": "netbird.example.com:10000",
    "Username": "",
    "Password": null
}
```

<Properties>
  <Property name="Proto" type="string">
    Protocol for signal communication. Options: `http`, `https`. Default: `http` (internal), `https` (external).
  </Property>
  <Property name="URI" type="string">
    Signal server address. Format: `hostname:port`
  </Property>
  <Property name="Username" type="string">
    Optional authentication username. Usually empty.
  </Property>
  <Property name="Password" type="string | null">
    Optional authentication password. Usually `null`.
  </Property>
</Properties>

### ReverseProxy Section

Configures trusted reverse proxies for proper client IP detection.

```json
"ReverseProxy": {
    "TrustedHTTPProxies": [],
    "TrustedHTTPProxiesCount": 0,
    "TrustedPeers": ["0.0.0.0/0"]
}
```

<Properties>
  <Property name="TrustedHTTPProxies" type="array">
    List of trusted proxy IP addresses or CIDR ranges.
  </Property>
  <Property name="TrustedHTTPProxiesCount" type="number">
    Number of trusted proxy hops. Used with X-Forwarded-For header parsing.
  </Property>
  <Property name="TrustedPeers" type="array">
    CIDR ranges of trusted peers. Default: `["0.0.0.0/0"]` (trust all).
  </Property>
</Properties>

<Note>
When running behind a reverse proxy, configure `TrustedHTTPProxies` with your proxy's IP to ensure accurate client IP logging and rate limiting.
</Note>

### StoreConfig Section

Configures the database backend for storing all NetBird management data.

**What data is stored in the database?**

The management database contains all persistent state for your NetBird deployment:

- **Accounts and users** - User accounts, roles, and permissions
- **Peers** - Registered devices, their WireGuard keys, IP assignments, and metadata
- **Groups** - Peer groupings used for access control and network organization
- **Access policies** - Network access rules defining which peers can communicate
- **Routes** - Network routes for accessing external subnets through NetBird peers
- **DNS configuration** - Custom DNS settings and nameserver groups
- **Setup keys** - Keys used for automated peer enrollment
- **Activity logs** - Audit trail of user and system actions
- **Posture checks** - Device security compliance policies

**Where is the data stored?**

| Engine | Storage Location | Notes |
|--------|------------------|-------|
| SQLite (default) | `/var/lib/netbird/` volume | File-based, stored in the `netbird-mgmt` Docker volume. Simple but limited to single-instance deployments. |
| PostgreSQL | External database server | Recommended for production. Supports high availability and backups. |
| MySQL | External database server | Alternative to PostgreSQL for organizations standardized on MySQL. |

```json
"StoreConfig": {
    "Engine": "sqlite"
}
```

<Properties>
  <Property name="Engine" type="string">
    Database engine. Options: `sqlite`, `postgres`, `mysql`. Default: `sqlite`
  </Property>
</Properties>

For PostgreSQL or MySQL, set the connection string via environment variables:
- `NETBIRD_STORE_ENGINE_POSTGRES_DSN` for PostgreSQL
- `NETBIRD_STORE_ENGINE_MYSQL_DSN` for MySQL

<Note>
For production deployments with multiple users or high availability requirements, consider using PostgreSQL. SQLite is convenient for testing and small deployments but does not support concurrent writes or easy backups while the service is running.
</Note>

See [Management Postgres Store](/selfhosted/postgres-store) for PostgreSQL setup.

### EmbeddedIdP Section

<Note>
This section is used by the **quickstart deployment** with the embedded identity provider. If you see this section in your `management.json`, you are using the embedded IdP and do **not** need to configure `HttpConfig`, `IdpManagerConfig`, `DeviceAuthorizationFlow`, or `PKCEAuthorizationFlow` manually.

**Want to use Google, Okta, self-hosted Authentik, or any other OIDC provider?** You do not need to disable the embedded IdP or edit this file. Instead, add your external IdP through **Settings → Identity Providers** in the Dashboard. The embedded IdP system supports connecting external providers through the UI.
</Note>

Configures the built-in identity provider that handles user authentication and management. The embedded IdP is based on DEX and supports both local user management and connections to external identity providers configured through the Dashboard.

```json
"EmbeddedIdP": {
    "Enabled": true,
    "Issuer": "https://netbird.example.com/oauth2",
    "DashboardRedirectURIs": [
        "https://netbird.example.com/nb-auth",
        "https://netbird.example.com/nb-silent-auth"
    ]
}
```

<Properties>
  <Property name="Enabled" type="boolean">
    Enable the embedded identity provider. When `true`, the management server hosts OAuth2/OIDC endpoints at `/oauth2/`. Default: `true` for quickstart deployments.
  </Property>
  <Property name="Issuer" type="string">
    The issuer URL for tokens. Should be `https://your-domain/oauth2`. This URL is used to validate JWT tokens and must be accessible to clients.
  </Property>
  <Property name="DashboardRedirectURIs" type="array">
    Allowed redirect URIs for OAuth2 authorization flow. Must include the dashboard authentication callbacks, typically `/nb-auth` and `/nb-silent-auth` on your domain.
  </Property>
</Properties>

When `EmbeddedIdP.Enabled` is `true`, the management server automatically:
- Hosts OIDC discovery at `https://your-domain/oauth2/.well-known/openid-configuration`
- Provides JWKS (signing keys) at `https://your-domain/oauth2/keys`
- Handles token issuance at `https://your-domain/oauth2/token`
- Manages device authorization at `https://your-domain/oauth2/device/authorize`
- Provides user management through the Dashboard UI

### HttpConfig Section

<Note>
**Quickstart users:** If your `management.json` contains an `EmbeddedIdP` section with `Enabled: true`, you do **not** need this section. The embedded IdP automatically configures HTTP authentication.

**Want to connect Google, Okta, self-hosted Authentik, or any other OIDC provider?** You do not need this section. The embedded IdP supports adding external identity providers through **Settings → Identity Providers** in the Dashboard. This section is only required for the [legacy advanced deployment method](/selfhosted/selfhosted-guide) where IdP configuration is done at the infrastructure level rather than through the Dashboard UI.
</Note>

Configures the HTTP API server and authentication. This section defines how the management server validates JWT tokens from your identity provider.

```json
"HttpConfig": {
    "Address": "0.0.0.0:33073",
    "AuthIssuer": "https://netbird.example.com/oauth2",
    "AuthAudience": "netbird-dashboard",
    "AuthKeysLocation": "https://netbird.example.com/oauth2/keys",
    "AuthUserIDClaim": "",
    "CertFile": "/etc/letsencrypt/live/netbird.example.com/fullchain.pem",
    "CertKey": "/etc/letsencrypt/live/netbird.example.com/privkey.pem",
    "IdpSignKeyRefreshEnabled": false,
    "OIDCConfigEndpoint": "https://netbird.example.com/oauth2/.well-known/openid-configuration"
}
```

<Properties>
  <Property name="Address" type="string">
    Listen address for HTTP API. Format: `host:port`. Default: `0.0.0.0:33073`
  </Property>
  <Property name="AuthIssuer" type="string">
    OAuth2 token issuer URL for validation.
  </Property>
  <Property name="AuthAudience" type="string">
    Expected audience claim in JWT tokens.
  </Property>
  <Property name="AuthKeysLocation" type="string">
    URL to fetch JWT signing keys (JWKS endpoint).
  </Property>
  <Property name="AuthUserIDClaim" type="string">
    JWT claim to use as user ID. Empty uses `sub` claim.
  </Property>
  <Property name="CertFile" type="string">
    Path to TLS certificate file.
  </Property>
  <Property name="CertKey" type="string">
    Path to TLS certificate key file.
  </Property>
  <Property name="IdpSignKeyRefreshEnabled" type="boolean">
    Enable automatic JWKS key refresh. Default: `false`
  </Property>
  <Property name="OIDCConfigEndpoint" type="string">
    OIDC discovery endpoint URL.
  </Property>
</Properties>

### IdpManagerConfig Section

<Note>
**Quickstart users:** This section is **not required** when using the embedded IdP. The embedded IdP manages user information internally and synchronizes with external identity providers added through the Dashboard.

**Want to connect Google, Okta, self-hosted Authentik, or any other OIDC provider?** You do not need this section. Add your external IdP through **Settings → Identity Providers** in the Dashboard - user details (names, emails, group memberships) will be synchronized automatically.

This section is only needed for the [legacy advanced deployment method](/selfhosted/selfhosted-guide) where the embedded IdP is disabled and NetBird needs to query an external IdP's management API directly for user details.
</Note>

Configures the Identity Provider manager for user information retrieval. When configured, NetBird uses the IdP's management API to fetch user details like display names, emails, and group memberships.

```json
"IdpManagerConfig": {
    "ManagerType": "none",
    "ClientConfig": {
        "Issuer": "https://netbird.example.com/oauth2",
        "TokenEndpoint": "https://netbird.example.com/oauth2/token",
        "ClientID": "netbird-mgmt",
        "ClientSecret": "your-client-secret",
        "GrantType": "client_credentials"
    },
    "ExtraConfig": {}
}
```

<Properties>
  <Property name="ManagerType" type="string">
    IdP type. Options: `none`, `auth0`, `azure`, `keycloak`, `zitadel`, `google`, `okta`, `jumpcloud`
  </Property>
  <Property name="ClientConfig.Issuer" type="string">
    OAuth2 issuer URL.
  </Property>
  <Property name="ClientConfig.TokenEndpoint" type="string">
    OAuth2 token endpoint URL.
  </Property>
  <Property name="ClientConfig.ClientID" type="string">
    Client ID for machine-to-machine authentication.
  </Property>
  <Property name="ClientConfig.ClientSecret" type="string">
    Client secret for machine-to-machine authentication.
  </Property>
  <Property name="ClientConfig.GrantType" type="string">
    OAuth2 grant type. Usually `client_credentials`.
  </Property>
  <Property name="ExtraConfig" type="object">
    Provider-specific additional configuration.
  </Property>
</Properties>

### DeviceAuthorizationFlow Section

<Note>
**Quickstart users:** This section is **not required** when using the embedded IdP. The embedded IdP automatically handles device authorization flow at `https://your-domain/oauth2/device/authorize`.

**Using external IdPs like Google, Okta, self-hosted Authentik, or any other OIDC provider?** If you added them through **Settings → Identity Providers** in the Dashboard, the device authorization flow works automatically - no configuration needed here.

This section is only needed for the [legacy advanced deployment method](/selfhosted/selfhosted-guide) where the embedded IdP is disabled and you need to configure device authorization directly with an external identity provider.
</Note>

Configures device authorization flow for CLI authentication. This flow enables users to authenticate NetBird clients via `netbird login` by visiting a URL and entering a code. It is particularly useful for headless devices or environments where browser-based login is impractical.

```json
"DeviceAuthorizationFlow": {
    "Provider": "none",
    "ProviderConfig": {
        "Audience": "netbird-dashboard",
        "ClientID": "netbird-client",
        "TokenEndpoint": "https://netbird.example.com/oauth2/token",
        "DeviceAuthEndpoint": "https://netbird.example.com/oauth2/device/authorize",
        "Scope": "openid",
        "UseIDToken": false
    }
}
```

<Properties>
  <Property name="Provider" type="string">
    Device auth provider. Options: `none`, `hosted`, `auth0`, `azure`, `keycloak`, `zitadel`, `okta`
  </Property>
  <Property name="ProviderConfig.Audience" type="string">
    OAuth2 audience for device tokens.
  </Property>
  <Property name="ProviderConfig.ClientID" type="string">
    Client ID for device authorization.
  </Property>
  <Property name="ProviderConfig.TokenEndpoint" type="string">
    Token exchange endpoint.
  </Property>
  <Property name="ProviderConfig.DeviceAuthEndpoint" type="string">
    Device authorization initiation endpoint.
  </Property>
  <Property name="ProviderConfig.Scope" type="string">
    OAuth2 scopes to request.
  </Property>
  <Property name="ProviderConfig.UseIDToken" type="boolean">
    Use ID token instead of access token. Default: `false`
  </Property>
</Properties>

### PKCEAuthorizationFlow Section

<Note>
**Quickstart users:** This section is **not required** when using the embedded IdP. The embedded IdP automatically handles PKCE authorization flow for desktop clients that launch a browser for authentication.

**Using external IdPs like Google, Okta, self-hosted Authentik, or any other OIDC provider?** If you added them through **Settings → Identity Providers** in the Dashboard, PKCE authentication works automatically - no configuration needed here.

This section is only needed for the [legacy advanced deployment method](/selfhosted/selfhosted-guide) where the embedded IdP is disabled and you need to configure PKCE flow directly with an external identity provider.
</Note>

Configures PKCE (Proof Key for Code Exchange) authorization flow for browser-based authentication. This flow is used by desktop clients that can launch a local web server to receive the OAuth callback, providing a more seamless authentication experience than the device flow.

```json
"PKCEAuthorizationFlow": {
    "ProviderConfig": {
        "Audience": "netbird-dashboard",
        "ClientID": "netbird-dashboard",
        "ClientSecret": "",
        "AuthorizationEndpoint": "https://netbird.example.com/oauth2/authorize",
        "TokenEndpoint": "https://netbird.example.com/oauth2/token",
        "Scope": "openid profile email groups",
        "RedirectURLs": ["http://localhost:53000"],
        "UseIDToken": false,
        "DisablePromptLogin": false,
        "LoginFlag": 0
    }
}
```

<Properties>
  <Property name="ProviderConfig.Audience" type="string">
    OAuth2 audience for PKCE tokens.
  </Property>
  <Property name="ProviderConfig.ClientID" type="string">
    Public client ID for PKCE flow.
  </Property>
  <Property name="ProviderConfig.ClientSecret" type="string">
    Optional client secret. Usually empty for public clients.
  </Property>
  <Property name="ProviderConfig.AuthorizationEndpoint" type="string">
    Authorization endpoint URL.
  </Property>
  <Property name="ProviderConfig.TokenEndpoint" type="string">
    Token endpoint URL.
  </Property>
  <Property name="ProviderConfig.Scope" type="string">
    OAuth2 scopes to request.
  </Property>
  <Property name="ProviderConfig.RedirectURLs" type="array">
    Allowed redirect URLs for PKCE flow.
  </Property>
  <Property name="ProviderConfig.UseIDToken" type="boolean">
    Use ID token instead of access token. Default: `false`
  </Property>
  <Property name="ProviderConfig.DisablePromptLogin" type="boolean">
    Skip login prompt for returning users. Default: `false`
  </Property>
  <Property name="ProviderConfig.LoginFlag" type="number">
    Login behavior flag. `0` = default, `1` = force login.
  </Property>
</Properties>

### Other Top-Level Settings

<Properties>
  <Property name="DisableDefaultPolicy" type="boolean">
    Disable the default "allow all" access policy for new accounts. When `true`, new accounts start with no access rules, requiring explicit policy creation before peers can communicate. Default: `false`
  </Property>
  <Property name="Datadir" type="string">
    Data directory path where the management service stores its database and state files. Usually set via command line (`--datadir`). Default: `/var/lib/netbird`
  </Property>
  <Property name="DataStoreEncryptionKey" type="string">
    32-byte (256-bit) encryption key for sensitive data at rest. Used to encrypt setup keys, API tokens, and other secrets stored in the database. Auto-generated by setup scripts.
  </Property>
</Properties>

<Warning>
Keep `DataStoreEncryptionKey` secure and backed up. This key encrypts sensitive data in your database, including setup keys and API tokens. Losing this key means losing access to encrypted data, and you will need to regenerate all setup keys and API tokens.
</Warning>

---

## relay.env

Environment configuration for the relay service. This file is mounted into the relay container and configures both the relay and the embedded STUN server.

```bash
# Log level: debug, info, warn, error
NB_LOG_LEVEL=info

# Address to listen on for relay connections
NB_LISTEN_ADDRESS=:80

# Public address for peers to connect
# Use rel:// for unencrypted or rels:// for TLS
NB_EXPOSED_ADDRESS=rels://netbird.example.com:443

# Authentication secret (must match management.json Relay.Secret)
NB_AUTH_SECRET=your-secret-here

# Embedded STUN server configuration
NB_ENABLE_STUN=true
NB_STUN_LOG_LEVEL=info
NB_STUN_PORTS=3478
```

### All Relay Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `NB_LOG_LEVEL` | `info` | Log verbosity |
| `NB_LISTEN_ADDRESS` | `:80` | Listen address for relay connections |
| `NB_EXPOSED_ADDRESS` | - | Public relay address for peers |
| `NB_AUTH_SECRET` | - | Shared authentication secret |
| `NB_ENABLE_STUN` | `false` | Enable embedded STUN server |
| `NB_STUN_PORTS` | `3478` | STUN server UDP ports (comma-separated) |
| `NB_STUN_LOG_LEVEL` | `info` | STUN server log level |
| `NB_METRICS_PORT` | - | Prometheus metrics port (optional) |
| `NB_TLS_CERT_FILE` | - | TLS certificate file path |
| `NB_TLS_KEY_FILE` | - | TLS key file path |
| `NB_LETSENCRYPT_DATA_DIR` | - | Let's Encrypt data directory |
| `NB_LETSENCRYPT_DOMAINS` | - | Domains for Let's Encrypt |
| `NB_LETSENCRYPT_EMAIL` | - | Let's Encrypt email |
| `NB_HEALTH_LISTEN_ADDRESS` | - | Health check endpoint address |

---

## dashboard.env

Environment configuration for the dashboard service.

```bash
# Endpoints
NETBIRD_MGMT_API_ENDPOINT=https://netbird.example.com
NETBIRD_MGMT_GRPC_API_ENDPOINT=https://netbird.example.com

# OIDC - using embedded IdP
AUTH_AUDIENCE=netbird-dashboard
AUTH_CLIENT_ID=netbird-dashboard
AUTH_CLIENT_SECRET=
AUTH_AUTHORITY=https://netbird.example.com/oauth2
USE_AUTH0=false
AUTH_SUPPORTED_SCOPES=openid profile email groups
AUTH_REDIRECT_URI=/nb-auth
AUTH_SILENT_REDIRECT_URI=/nb-silent-auth

# SSL
NGINX_SSL_PORT=443

# Letsencrypt
LETSENCRYPT_DOMAIN=netbird.example.com
LETSENCRYPT_EMAIL=admin@example.com
```

### Endpoint Configuration

| Variable | Description |
|----------|-------------|
| `NETBIRD_MGMT_API_ENDPOINT` | Management REST API endpoint URL |
| `NETBIRD_MGMT_GRPC_API_ENDPOINT` | Management gRPC endpoint URL |

### Authentication Configuration

| Variable | Description |
|----------|-------------|
| `AUTH_AUDIENCE` | OAuth2 audience claim |
| `AUTH_CLIENT_ID` | OAuth2 client ID |
| `AUTH_CLIENT_SECRET` | OAuth2 client secret (empty for public clients) |
| `AUTH_AUTHORITY` | OAuth2 issuer URL |
| `USE_AUTH0` | Set to `true` when using Auth0 |
| `AUTH_SUPPORTED_SCOPES` | Space-separated OAuth2 scopes |
| `AUTH_REDIRECT_URI` | OAuth2 redirect path |
| `AUTH_SILENT_REDIRECT_URI` | Silent auth redirect path |

### SSL/TLS Configuration

| Variable | Default | Description |
|----------|---------|-------------|
| `NGINX_SSL_PORT` | `443` | HTTPS port |
| `LETSENCRYPT_DOMAIN` | - | Domain for Let's Encrypt (set to `none` to disable) |
| `LETSENCRYPT_EMAIL` | - | Email for Let's Encrypt |

---

## Common Configuration Scenarios

### Using an External Database

To use PostgreSQL instead of SQLite:

1. Update `management.json`:
```json
"StoreConfig": {
    "Engine": "postgres"
}
```

2. Set the connection string in `docker-compose.yml`:
```yaml
management:
  environment:
    - NETBIRD_STORE_ENGINE_POSTGRES_DSN=postgres://user:password@host:5432/netbird?sslmode=disable
```

See [Management Postgres Store](/selfhosted/postgres-store) for detailed setup.

### Disabling Anonymous Metrics

In `docker-compose.yml`, update the management command:

```yaml
management:
  command: [
    "--port", "443",
    "--disable-anonymous-metrics=true",
    # ... other flags
  ]
```

### Custom Relay Configuration

To use multiple relay servers, update `management.json`:

```json
"Relay": {
    "Addresses": [
        "rel://relay1.example.com:33080",
        "rel://relay2.example.com:33080"
    ],
    "CredentialsTTL": "24h",
    "Secret": "shared-secret"
}
```

Each relay server must use the same `NB_AUTH_SECRET`.

### Behind a Reverse Proxy

When running behind your own reverse proxy (Traefik, Nginx, etc.):

1. Set `LETSENCRYPT_DOMAIN=none` in `dashboard.env`
2. Configure trusted proxies in `management.json`:
```json
"ReverseProxy": {
    "TrustedHTTPProxies": ["10.0.0.1"],
    "TrustedHTTPProxiesCount": 1,
    "TrustedPeers": ["10.0.0.0/8"]
}
```

See [Reverse Proxy Configuration](/selfhosted/reverse-proxy) for detailed templates.

### Configuring External TURN Servers

<Note>
The default NetBird deployment uses the relay service for NAT traversal, which handles most connectivity scenarios. External TURN servers are only needed for advanced use cases like geographically distributed deployments or environments with restrictive firewalls that block the relay protocol.
</Note>

To use external TURN servers (e.g., coturn deployed separately):

```json
"TURNConfig": {
    "Turns": [
        {
            "Proto": "udp",
            "URI": "turn:turn-us.example.com:3478",
            "Username": "netbird",
            "Password": "password1"
        },
        {
            "Proto": "udp",
            "URI": "turn:turn-eu.example.com:3478",
            "Username": "netbird",
            "Password": "password2"
        }
    ],
    "CredentialsTTL": "12h",
    "TimeBasedCredentials": false
}
```

---

## See Also

- [Self-hosting Quickstart Guide](/selfhosted/selfhosted-quickstart) - Get started quickly with default settings
- [Advanced Self-hosting Guide](/selfhosted/selfhosted-guide) - Custom IdP integration
- [Environment Variables](/selfhosted/environment-variables) - Runtime environment configuration
- [Reverse Proxy Configuration](/selfhosted/reverse-proxy) - Traefik, Nginx, Caddy setup
- [Management SQLite Store](/selfhosted/sqlite-store) - SQLite database details
- [Management Postgres Store](/selfhosted/postgres-store) - PostgreSQL setup
