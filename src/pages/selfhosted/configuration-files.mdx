import {Note, Warning} from "@/components/mdx";
import {Properties, Property} from "@/components/mdx";

# Self-Hosted Deployment Configuration Files Reference

This page provides a comprehensive reference for all configuration files used when self-hosting NetBird with the `getting-started.sh` deployment method. Understanding these files helps you customize your deployment, troubleshoot issues, and integrate with existing infrastructure.

<Note>
Configuration files are **generated automatically** by the `getting-started.sh` script. Modifying files directly is only necessary for advanced customization after initial setup.
</Note>

## Overview

A standard NetBird self-hosted deployment uses the following configuration files:

| File | Purpose |
|------|---------|
| `docker-compose.yml` | Defines all NetBird services (dashboard, netbird-server), their Docker images, port mappings, volumes, and startup order. Modify this to change resource limits, add services, or adjust networking. |
| `config.yaml` | Central configuration for the NetBird server including listen addresses, authentication settings, STUN ports, and database configuration. Changes here affect how peers connect and authenticate. |
| `dashboard.env` | Configures the web dashboard including API endpoints, OAuth2/OIDC settings, and optional SSL settings for standalone deployments without a reverse proxy. |
| `Caddyfile` | Configures the built-in Caddy reverse proxy for SSL termination and routing requests to NetBird services. Only present when using the default `getting-started.sh` deployment with Caddy. |

### File Locations

After running the installation script, configuration files are located in the directory where you ran the script (typically `~/netbird/` or the current working directory):

```
./
├── docker-compose.yml
├── config.yaml
├── dashboard.env
└── Caddyfile          # Only when using built-in Caddy
```

---

## docker-compose.yml

The Docker Compose file defines all NetBird services, their dependencies, networking, and volumes.

### Services Overview

| Service | Image | Internal Port | External (Exposed) | Description |
|---------|-------|---------------|-------------------|-------------|
| `dashboard` | `netbirdio/dashboard` | 80 | 8080:80 | The web-based management console where administrators configure networks, manage peers, create access policies, and view activity logs. Includes an embedded nginx server for serving the UI. |
| `netbird-server` | `netbirdio/netbird-server` | 80, 3478/udp | 8081:80, 3478:3478/udp | The combined NetBird server that includes management, signal, and relay services in a single container. Also provides embedded STUN on UDP 3478 for NAT type detection. |
| `caddy` | `caddy` | 80, 443 | 80:80, 443:443 | Handles TLS termination and routes incoming HTTPS requests to the appropriate NetBird services. Only included in default `getting-started.sh` deployments; can be replaced with your own reverse proxy. |

<Note>
**Internal vs External ports**: Internal ports are what services listen on inside their containers. External (Exposed) ports show the host-to-container mapping used when running without the built-in Caddy (e.g., with Nginx, Traefik, or other reverse proxies). When using the default Caddy deployment, only Caddy exposes ports externally.
</Note>

<Note>
The combined server includes an embedded STUN server, eliminating the need for a separate coturn container. STUN functionality is configured via the `stunPorts` setting in `config.yaml`.
</Note>

### Default Settings

The compose file includes these defaults applied to all services:

```yaml
x-default: &default
  restart: 'unless-stopped'
  logging:
    driver: 'json-file'
    options:
      max-size: '500m'
      max-file: '2'
```

### Dashboard Service

The dashboard provides the web interface for NetBird management.

**With built-in Caddy (default):**
```yaml
dashboard:
  image: netbirdio/dashboard:latest
  container_name: netbird-dashboard
  restart: unless-stopped
  networks: [netbird]
  env_file:
    - ./dashboard.env
  logging:
    driver: "json-file"
    options:
      max-size: "500m"
      max-file: "2"
```

**With external reverse proxy (exposed ports):**
```yaml
dashboard:
  image: netbirdio/dashboard:latest
  container_name: netbird-dashboard
  restart: unless-stopped
  networks: [netbird]
  ports:
    - '127.0.0.1:8080:80'
  env_file:
    - ./dashboard.env
  logging:
    driver: "json-file"
    options:
      max-size: "500m"
      max-file: "2"
```

<Note>
The dashboard service is configured via the `dashboard.env` file. See the [dashboard.env section](#dashboard-env) for the full list of environment variables. When using the built-in Caddy, no ports are exposed directly from the dashboard container; Caddy routes traffic to it internally.
</Note>

### Combined NetBird Server Service

The combined NetBird server is the core of NetBird, handling peer registration, authentication, signaling, and relay in a single container.

**With built-in Caddy (default):**
```yaml
netbird-server:
  image: netbirdio/netbird-server:latest
  container_name: netbird-server
  restart: unless-stopped
  networks: [netbird]
  ports:
    - '3478:3478/udp'   # Embedded STUN server (must be exposed publicly)
  volumes:
    - netbird_data:/var/lib/netbird
    - ./config.yaml:/etc/netbird/config.yaml
  command: ["--config", "/etc/netbird/config.yaml"]
  logging:
    driver: "json-file"
    options:
      max-size: "500m"
      max-file: "2"
```

**With external reverse proxy (exposed ports):**
```yaml
netbird-server:
  image: netbirdio/netbird-server:latest
  container_name: netbird-server
  restart: unless-stopped
  networks: [netbird]
  ports:
    - '127.0.0.1:8081:80'   # HTTP (for reverse proxy)
    - '3478:3478/udp'       # Embedded STUN server (must be exposed publicly)
  volumes:
    - netbird_data:/var/lib/netbird
    - ./config.yaml:/etc/netbird/config.yaml
  command: ["--config", "/etc/netbird/config.yaml"]
  logging:
    driver: "json-file"
    options:
      max-size: "500m"
      max-file: "2"
```

<Note>
The STUN port (3478/udp) must always be exposed publicly, regardless of reverse proxy configuration. STUN uses UDP for NAT detection and cannot be proxied through HTTP reverse proxies.
</Note>

To use an external database, add environment variables:
```yaml
  environment:
    - NETBIRD_STORE_ENGINE_POSTGRES_DSN=postgres://user:password@host:5432/netbird
    # Or for MySQL:
    # - NETBIRD_STORE_ENGINE_MYSQL_DSN=user:password@tcp(host:3306)/netbird
```

### Volume Configuration

| Volume | Mount Point | Purpose |
|--------|-------------|---------|
| `netbird_data` | `/var/lib/netbird` | Stores the management database (SQLite by default), encryption keys, and persistent state. Back up this volume regularly to preserve your accounts, peers, policies, and setup keys. |
| `netbird_caddy_data` | `/data` | Stores Caddy's TLS certificates and other persistent data. Only used when deploying with the built-in Caddy reverse proxy. Preserve this volume to maintain TLS certificates across restarts. |

<Note>
The `getting-started.sh` deployment uses only two volumes: `netbird_data` for the server database and `netbird_caddy_data` for Caddy's certificate storage.
</Note>

---

## config.yaml

The `config.yaml` file is the central configuration for the combined NetBird server. It configures management, signal, relay, and STUN services in a single file.

### Complete Structure

```yaml
server:
  listenAddress: ":80"
  exposedAddress: "https://netbird.example.com:443"
  stunPorts:
    - 3478
  metricsPort: 9090
  healthcheckAddress: ":9000"
  logLevel: "info"
  logFile: "console"

  authSecret: "your-relay-auth-secret"
  dataDir: "/var/lib/netbird"

  auth:
    enabled: true
    issuer: "https://netbird.example.com/oauth2"
    signKeyRefreshEnabled: true
    storage:
      type: "sqlite3"
    dashboardRedirectURIs:
      - "https://netbird.example.com/nb-auth"
      - "https://netbird.example.com/nb-silent-auth"
    cliRedirectURIs:
      - "http://localhost:53000/"

  store:
    engine: "sqlite"
    encryptionKey: "your-encryption-key"
```

### Server Settings

<Properties>
  <Property name="listenAddress" type="string">
    The address and port the server listens on inside the container. Format: `:port` or `address:port`. Default: `:80`
  </Property>
  <Property name="exposedAddress" type="string">
    The public address peers use to connect to this server. Use `https://` for TLS. Must be reachable from all peers.
  </Property>
  <Property name="stunPorts" type="array">
    UDP port(s) for the embedded STUN server. Must be exposed in `docker-compose.yml` and reachable through firewalls. Default: `[3478]`
  </Property>
  <Property name="metricsPort" type="number">
    Port to expose Prometheus metrics endpoint. When set, the server exposes metrics at `/metrics` for monitoring.
  </Property>
  <Property name="healthcheckAddress" type="string">
    Address for health check endpoint (e.g., `:9000`). When set, exposes `/health` for container orchestration and load balancer health probes.
  </Property>
  <Property name="logLevel" type="string">
    Controls log verbosity. Options: `debug`, `info`, `warn`, `error`. Default: `info`
  </Property>
  <Property name="logFile" type="string">
    Where to write log output. Use `console` for Docker logging (recommended) or specify a file path.
  </Property>
  <Property name="authSecret" type="string">
    Shared secret used to authenticate relay connections. Auto-generated by the setup script.
  </Property>
  <Property name="dataDir" type="string">
    Directory where the server stores its database and persistent state. Default: `/var/lib/netbird`
  </Property>
</Properties>

### Authentication (auth)

Configures the built-in identity provider that handles user authentication and management.

<Properties>
  <Property name="auth.enabled" type="boolean">
    Enable the embedded identity provider. When `true`, the server hosts OAuth2/OIDC endpoints at `/oauth2/`.
  </Property>
  <Property name="auth.issuer" type="string">
    The OAuth2/OIDC issuer URL (e.g., `https://netbird.example.com/oauth2`). This URL is used to validate JWT tokens.
  </Property>
  <Property name="auth.signKeyRefreshEnabled" type="boolean">
    Enables automatic refresh of IdP signing keys. Recommended for production.
  </Property>
  <Property name="auth.storage.type" type="string">
    Storage backend for IdP data. Default: `sqlite3`
  </Property>
  <Property name="auth.dashboardRedirectURIs" type="array">
    OAuth2 redirect URIs for the dashboard application.
  </Property>
  <Property name="auth.cliRedirectURIs" type="array">
    OAuth2 redirect URIs for CLI authentication.
  </Property>
</Properties>

When `auth.enabled` is `true`, the server automatically:
- Hosts OIDC discovery at `https://your-domain/oauth2/.well-known/openid-configuration`
- Provides JWKS (signing keys) at `https://your-domain/oauth2/keys`
- Handles token issuance at `https://your-domain/oauth2/token`
- Manages device authorization at `https://your-domain/oauth2/device/authorize`
- Provides user management through the Dashboard UI

### Database (store)

Configures the database backend for storing all NetBird data.

<Properties>
  <Property name="store.engine" type="string">
    Database engine. Options: `sqlite`, `postgres`, `mysql`. Default: `sqlite`
  </Property>
  <Property name="store.encryptionKey" type="string">
    Key used to encrypt sensitive data in the database. Keep this secure and backed up.
  </Property>
</Properties>

**What data is stored?**

- **Accounts and users** - User accounts, roles, and permissions
- **Peers** - Registered devices, their WireGuard keys, IP assignments, and metadata
- **Groups** - Peer groupings used for access control
- **Access policies** - Network access rules
- **Routes** - Network routes for external subnets
- **DNS configuration** - Custom DNS settings
- **Setup keys** - Keys for automated peer enrollment
- **Activity logs** - Audit trail

For PostgreSQL or MySQL, set the connection string via environment variables:
- `NETBIRD_STORE_ENGINE_POSTGRES_DSN` for PostgreSQL
- `NETBIRD_STORE_ENGINE_MYSQL_DSN` for MySQL

<Warning>
Keep `encryptionKey` secure and backed up. This key encrypts sensitive data in your database. Losing this key means losing access to encrypted data, and you will need to regenerate all setup keys and API tokens.
</Warning>

See [Management Postgres Store](/selfhosted/postgres-store) for PostgreSQL setup.

---

## dashboard.env

Environment configuration for the dashboard service.

### Dashboard Architecture

The NetBird dashboard container includes an **embedded nginx server** that serves the dashboard web pages. This nginx instance is built into the container image and handles serving the static web UI files.

```
┌─────────────────────────────────────────────────────────────────┐
│                     Dashboard Container                         │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                   Embedded Nginx                          │  │
│  │  - Serves dashboard web UI                                │  │
│  │  - Can handle SSL/TLS termination (standalone mode)       │  │
│  │  - Configurable via NGINX_* environment variables         │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

The `NGINX_SSL_PORT` and other `NGINX_*` environment variables control this embedded nginx server, not an external reverse proxy.

```bash
# Endpoints
NETBIRD_MGMT_API_ENDPOINT=https://netbird.example.com
NETBIRD_MGMT_GRPC_API_ENDPOINT=https://netbird.example.com

# OIDC - using embedded IdP
AUTH_AUDIENCE=netbird-dashboard
AUTH_CLIENT_ID=netbird-dashboard
AUTH_CLIENT_SECRET=
AUTH_AUTHORITY=https://netbird.example.com/oauth2
USE_AUTH0=false
AUTH_SUPPORTED_SCOPES=openid profile email groups
AUTH_REDIRECT_URI=/nb-auth
AUTH_SILENT_REDIRECT_URI=/nb-silent-auth

# SSL - disabled when behind reverse proxy (Caddy handles TLS)
NGINX_SSL_PORT=443
LETSENCRYPT_DOMAIN=none
```

<Note>
When using the built-in Caddy or an external reverse proxy, set `LETSENCRYPT_DOMAIN=none` because the reverse proxy handles TLS termination. Only set a domain here if running the dashboard standalone without a reverse proxy.
</Note>

### Endpoint Configuration

| Variable | Description |
|----------|-------------|
| `NETBIRD_MGMT_API_ENDPOINT` | The URL where the dashboard makes REST API calls to the management server (e.g., `https://netbird.example.com`). Must be accessible from users' browsers since API calls are made client-side. |
| `NETBIRD_MGMT_GRPC_API_ENDPOINT` | The URL for gRPC communication with the management server. Usually the same as the REST endpoint. Used for in-browser SSH and RDP clients, as well as surfacing management links for client config instructions. |

### Authentication Configuration

| Variable | Description |
|----------|-------------|
| `AUTH_AUDIENCE` | The expected audience claim in OAuth2 tokens. Must match the audience configured in your IdP. For embedded IdP, use `netbird-dashboard`. Incorrect values cause authentication failures. |
| `AUTH_CLIENT_ID` | The OAuth2 client identifier for the dashboard application. For embedded IdP deployments, this is `netbird-dashboard`. Must match the client ID registered with your identity provider. |
| `AUTH_CLIENT_SECRET` | OAuth2 client secret for confidential clients. Leave empty for public clients (the default for browser-based apps like the dashboard). Only set this if your IdP requires a confidential client. |
| `AUTH_AUTHORITY` | The OAuth2/OIDC issuer URL (e.g., `https://netbird.example.com/oauth2` for embedded IdP). The dashboard fetches OIDC discovery metadata from `{AUTH_AUTHORITY}/.well-known/openid-configuration`. |
| `USE_AUTH0` | Set to `true` only when using Auth0 as your identity provider. Enables Auth0-specific authentication behavior. Leave as `false` for embedded IdP or other OIDC providers. |
| `AUTH_SUPPORTED_SCOPES` | Space-separated list of OAuth2 scopes to request during login. Standard value is `openid profile email groups`. The `groups` scope enables group-based access control if supported by your IdP. |
| `AUTH_REDIRECT_URI` | The path where the IdP redirects after authentication (e.g., `/nb-auth`). Must match a redirect URI registered with your identity provider. Incorrect values cause OAuth2 callback errors. |
| `AUTH_SILENT_REDIRECT_URI` | The path for silent token refresh (e.g., `/nb-silent-auth`). Used by the dashboard to refresh tokens in the background without user interaction. Must also be registered with your IdP. |

### Embedded Nginx Configuration

The dashboard container's embedded nginx server can be configured using these environment variables. These settings control how the dashboard serves its web UI.

| Variable | Default | Description |
|----------|---------|-------------|
| `NGINX_SSL_PORT` | `443` | The HTTPS port for the dashboard's embedded nginx server. Only relevant in standalone mode without an external reverse proxy. When behind a reverse proxy, the dashboard serves HTTP internally. |
| `LETSENCRYPT_DOMAIN` | - | The domain name for automatic Let's Encrypt certificate provisioning. Set to `none` when using an external reverse proxy that handles TLS. The domain must resolve to this server for ACME challenges to succeed. |
| `LETSENCRYPT_EMAIL` | - | Email address for Let's Encrypt account registration and certificate expiry notifications. Required when `LETSENCRYPT_DOMAIN` is set. Let's Encrypt sends renewal reminders to this address. |

<Note>
**When do you need these nginx variables?**

The `NGINX_SSL_PORT` and Let's Encrypt variables are **only necessary when running the dashboard standalone** without an external reverse proxy. In standalone mode, the dashboard's embedded nginx handles SSL/TLS termination directly.

**For most installations** that use the built-in Caddy reverse proxy (the default `getting-started.sh` deployment) or an external reverse proxy like Traefik or Nginx, **you do not need to configure these nginx variables**. The reverse proxy handles SSL termination and routes traffic to the dashboard container, which serves content over HTTP internally.

When behind a reverse proxy:
- Set `LETSENCRYPT_DOMAIN=none` to disable the dashboard's internal Let's Encrypt
- The embedded nginx will serve on HTTP (port 80) internally
- Your reverse proxy handles HTTPS and forwards requests to the dashboard
</Note>

---

## Common Configuration Scenarios

### Using an External Database

To use PostgreSQL instead of SQLite:

1. Update `config.yaml`:
```yaml
server:
  store:
    engine: "postgres"
```

2. Set the connection string in `docker-compose.yml`:
```yaml
netbird-server:
  environment:
    - NETBIRD_STORE_ENGINE_POSTGRES_DSN=postgres://user:password@host:5432/netbird?sslmode=disable
```

See [Management Postgres Store](/selfhosted/postgres-store) for detailed setup.

### Custom STUN Ports

To use multiple STUN ports, update `config.yaml`:

```yaml
server:
  stunPorts:
    - 3478
    - 3479
```

Make sure to expose all ports in `docker-compose.yml`:
```yaml
netbird-server:
  ports:
    - '3478:3478/udp'
    - '3479:3479/udp'
```

### Behind a Reverse Proxy

When running behind your own reverse proxy (Traefik, Nginx, etc.):

1. Set `LETSENCRYPT_DOMAIN=none` in `dashboard.env`
2. The combined server handles trusted proxy detection automatically when running behind Caddy or other proxies.

See [Reverse Proxy Configuration](/selfhosted/reverse-proxy) for detailed templates.

### Using External Services (Advanced)

<Note>
The default NetBird deployment includes embedded relay, signal, and STUN services. External services are only needed for advanced use cases.
</Note>

To use external STUN, relay, or signal servers, add overrides to `config.yaml`:

```yaml
server:
  # ... basic settings ...

  # Optional: Use external STUN servers
  stuns:
    - uri: "stun:stun.example.com:3478"
      proto: "udp"

  # Optional: Use external relay servers
  relays:
    addresses:
      - "rels://relay.example.com:443"
    secret: "relay-auth-secret"
    credentialsTTL: "24h"

  # Optional: Use external signal server
  signalUri: "https://signal.example.com:443"
```
See the [From Homelab to Production guide]() for more details on configuring external services.

---

## See Also

- [Self-hosting Quickstart Guide](/selfhosted/selfhosted-quickstart) - Get started quickly with default settings
- [Reverse Proxy Configuration](/selfhosted/reverse-proxy) - Traefik, Nginx, Caddy setup
- [Management SQLite Store](/selfhosted/sqlite-store) - SQLite database details
- [Management Postgres Store](/selfhosted/postgres-store) - PostgreSQL setup
