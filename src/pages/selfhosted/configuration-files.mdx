import {Note, Warning} from "@/components/mdx";
import {Properties, Property} from "@/components/mdx";

# Configuration Files Reference

This page provides a comprehensive reference for all configuration files used when self-hosting NetBird. Understanding these files helps you customize your deployment, troubleshoot issues, and integrate with existing infrastructure.

<Note>
Most configuration files are **generated automatically** by the `getting-started.sh` or `configure.sh` scripts. Modifying files directly is only necessary for advanced customization. Changes to `setup.env` require re-running the configuration script to take effect.
</Note>

## Overview

A standard NetBird self-hosted deployment uses the following configuration files:

| File | Purpose | Generated By |
|------|---------|--------------|
| `docker-compose.yml` | Service definitions and orchestration | `getting-started.sh` / `configure.sh` |
| `management.json` | Core management server configuration | `getting-started.sh` / `configure.sh` |
| `relay.env` | Relay server environment variables | `getting-started.sh` |
| `dashboard.env` | Dashboard UI configuration | `getting-started.sh` |
| `turnserver.conf` | Coturn STUN/TURN server configuration | `getting-started.sh` / `configure.sh` |
| `Caddyfile` | Reverse proxy configuration (when using built-in Caddy) | `getting-started.sh` |

### File Locations

After running the installation script, configuration files are located in the directory where you ran the script (typically `~/netbird/` or the current working directory):

```
./
├── docker-compose.yml
├── management.json
├── relay.env
├── dashboard.env
├── turnserver.conf
└── Caddyfile          # Only when using built-in Caddy
```

---

## docker-compose.yml

The Docker Compose file defines all NetBird services, their dependencies, networking, and volumes.

### Services Overview

| Service | Image | Default Port | Description |
|---------|-------|--------------|-------------|
| `dashboard` | `netbirdio/dashboard` | 80, 443 | Web UI for managing NetBird |
| `management` | `netbirdio/management` | 33073 | Core API and peer coordination |
| `signal` | `netbirdio/signal` | 10000 | WebRTC signaling for peer connections |
| `relay` | `netbirdio/relay` | 33080 | Relay server for NAT traversal |
| `coturn` | `coturn/coturn` | 3478 | STUN/TURN server for connectivity |
| `caddy` | `caddy` | 80, 443 | Reverse proxy (optional, built-in setup) |

### Default Settings

The compose file includes these defaults applied to all services:

```yaml
x-default: &default
  restart: 'unless-stopped'
  logging:
    driver: 'json-file'
    options:
      max-size: '500m'
      max-file: '2'
```

### Dashboard Service

The dashboard provides the web interface for NetBird management.

```yaml
dashboard:
  image: netbirdio/dashboard:latest
  ports:
    - 80:80
    - 443:443
  environment:
    - NETBIRD_MGMT_API_ENDPOINT=https://netbird.example.com
    - NETBIRD_MGMT_GRPC_API_ENDPOINT=https://netbird.example.com
    - AUTH_AUDIENCE=netbird-dashboard
    - AUTH_CLIENT_ID=netbird-dashboard
    - AUTH_AUTHORITY=https://netbird.example.com/oauth2
    - USE_AUTH0=false
    - AUTH_SUPPORTED_SCOPES=openid profile email groups
    - AUTH_REDIRECT_URI=/nb-auth
    - AUTH_SILENT_REDIRECT_URI=/nb-silent-auth
    - NGINX_SSL_PORT=443
    - LETSENCRYPT_DOMAIN=netbird.example.com
    - LETSENCRYPT_EMAIL=admin@example.com
  volumes:
    - netbird-letsencrypt:/etc/letsencrypt/
```

<Properties>
  <Property name="NETBIRD_MGMT_API_ENDPOINT" type="string">
    Full URL to the Management API endpoint. Used for REST API calls from the dashboard.
  </Property>
  <Property name="NETBIRD_MGMT_GRPC_API_ENDPOINT" type="string">
    Full URL to the Management gRPC endpoint. Usually the same as the API endpoint.
  </Property>
  <Property name="AUTH_AUDIENCE" type="string">
    OAuth2 audience for token validation. Default: `netbird-dashboard`
  </Property>
  <Property name="AUTH_CLIENT_ID" type="string">
    OAuth2 client ID for the dashboard application.
  </Property>
  <Property name="AUTH_AUTHORITY" type="string">
    OAuth2 issuer URL. For embedded IdP: `https://your-domain/oauth2`
  </Property>
  <Property name="USE_AUTH0" type="boolean">
    Set to `true` if using Auth0 as the identity provider. Default: `false`
  </Property>
  <Property name="AUTH_SUPPORTED_SCOPES" type="string">
    Space-separated OAuth2 scopes. Default: `openid profile email groups`
  </Property>
  <Property name="AUTH_REDIRECT_URI" type="string">
    OAuth2 redirect URI path. Default: `/nb-auth`
  </Property>
  <Property name="AUTH_SILENT_REDIRECT_URI" type="string">
    Silent authentication redirect URI. Default: `/nb-silent-auth`
  </Property>
  <Property name="NGINX_SSL_PORT" type="number">
    HTTPS port for the dashboard. Default: `443`
  </Property>
  <Property name="LETSENCRYPT_DOMAIN" type="string">
    Domain for Let's Encrypt certificate. Set to `none` to disable.
  </Property>
  <Property name="LETSENCRYPT_EMAIL" type="string">
    Email for Let's Encrypt registration and renewal notices.
  </Property>
</Properties>

### Management Service

The management service is the core of NetBird, handling peer registration, authentication, and network coordination.

```yaml
management:
  image: netbirdio/management:latest
  depends_on:
    - dashboard
  volumes:
    - netbird-mgmt:/var/lib/netbird
    - netbird-letsencrypt:/etc/letsencrypt:ro
    - ./management.json:/etc/netbird/management.json
  ports:
    - 33073:443
  command: [
    "--port", "443",
    "--log-file", "console",
    "--log-level", "info",
    "--disable-anonymous-metrics=false",
    "--single-account-mode-domain=netbird.example.com",
    "--dns-domain=netbird.selfhosted"
  ]
  environment:
    - NETBIRD_STORE_ENGINE_POSTGRES_DSN=
    - NETBIRD_STORE_ENGINE_MYSQL_DSN=
```

#### Command-Line Flags

| Flag | Default | Description |
|------|---------|-------------|
| `--port` | `443` | Internal listening port |
| `--log-file` | `console` | Log output destination |
| `--log-level` | `info` | Log verbosity: `debug`, `info`, `warn`, `error` |
| `--disable-anonymous-metrics` | `false` | Disable anonymous usage metrics |
| `--single-account-mode-domain` | - | Domain for single account mode |
| `--dns-domain` | `netbird.selfhosted` | DNS domain for peer resolution |

### Signal Service

The signal service handles WebRTC signaling for establishing peer-to-peer connections.

```yaml
signal:
  image: netbirdio/signal:latest
  depends_on:
    - dashboard
  volumes:
    - netbird-signal:/var/lib/netbird
    - netbird-letsencrypt:/etc/letsencrypt:ro
  ports:
    - 10000:80
  command: [
    "--cert-file", "/etc/letsencrypt/live/netbird.example.com/fullchain.pem",
    "--cert-key", "/etc/letsencrypt/live/netbird.example.com/privkey.pem",
    "--log-file", "console",
    "--port", "80"
  ]
```

### Relay Service

The relay service provides NAT traversal when direct peer-to-peer connections are not possible.

```yaml
relay:
  image: netbirdio/relay:latest
  environment:
    - NB_LOG_LEVEL=info
    - NB_LISTEN_ADDRESS=:33080
    - NB_EXPOSED_ADDRESS=rel://netbird.example.com:33080
    - NB_AUTH_SECRET=your-secret-here
  ports:
    - 33080:33080
```

<Properties>
  <Property name="NB_LOG_LEVEL" type="string">
    Log verbosity level. Options: `debug`, `info`, `warn`, `error`. Default: `info`
  </Property>
  <Property name="NB_LISTEN_ADDRESS" type="string">
    Address and port to listen on. Format: `:port`. Default: `:33080`
  </Property>
  <Property name="NB_EXPOSED_ADDRESS" type="string">
    Public address for peers to connect. Format: `rel://hostname:port`
  </Property>
  <Property name="NB_AUTH_SECRET" type="string">
    Shared secret for relay authentication. Must match `management.json` Relay.Secret.
  </Property>
</Properties>

### Coturn Service

Coturn provides STUN/TURN services for NAT traversal.

```yaml
coturn:
  image: coturn/coturn:latest
  volumes:
    - ./turnserver.conf:/etc/turnserver.conf:ro
  network_mode: host
  command:
    - -c /etc/turnserver.conf
```

<Note>
Coturn uses `network_mode: host` for optimal TURN relay performance. This means it binds directly to the host's network interfaces.
</Note>

### Volume Configuration

| Volume | Mount Point | Purpose |
|--------|-------------|---------|
| `netbird-mgmt` | `/var/lib/netbird` | Management database and state |
| `netbird-signal` | `/var/lib/netbird` | Signal service data |
| `netbird-letsencrypt` | `/etc/letsencrypt` | TLS certificates |

---

## management.json

The management configuration file controls the core behavior of the NetBird Management service. This is the most complex configuration file.

### Complete Structure

```json
{
    "Stuns": [...],
    "TURNConfig": {...},
    "Relay": {...},
    "Signal": {...},
    "ReverseProxy": {...},
    "DisableDefaultPolicy": false,
    "DataStoreEncryptionKey": "...",
    "StoreConfig": {...},
    "HttpConfig": {...},
    "IdpManagerConfig": {...},
    "DeviceAuthorizationFlow": {...},
    "PKCEAuthorizationFlow": {...}
}
```

### Stuns Section

Configures STUN servers used for NAT detection.

```json
"Stuns": [
    {
        "Proto": "udp",
        "URI": "stun:netbird.example.com:3478",
        "Username": "",
        "Password": null
    }
]
```

<Properties>
  <Property name="Proto" type="string">
    Protocol for STUN communication. Options: `udp`, `tcp`. Default: `udp`
  </Property>
  <Property name="URI" type="string">
    STUN server URI. Format: `stun:hostname:port`
  </Property>
  <Property name="Username" type="string">
    Optional username for authenticated STUN. Usually empty.
  </Property>
  <Property name="Password" type="string | null">
    Optional password for authenticated STUN. Usually `null`.
  </Property>
</Properties>

### TURNConfig Section

Configures TURN servers for relay when direct connections fail.

```json
"TURNConfig": {
    "Turns": [
        {
            "Proto": "udp",
            "URI": "turn:netbird.example.com:3478",
            "Username": "netbird",
            "Password": "your-turn-password"
        }
    ],
    "CredentialsTTL": "12h",
    "Secret": "secret",
    "TimeBasedCredentials": false
}
```

<Properties>
  <Property name="Turns" type="array">
    Array of TURN server configurations.
  </Property>
  <Property name="Turns[].Proto" type="string">
    Protocol: `udp`, `tcp`, or `tls`. Default: `udp`
  </Property>
  <Property name="Turns[].URI" type="string">
    TURN server URI. Format: `turn:hostname:port` or `turns:hostname:port` for TLS.
  </Property>
  <Property name="Turns[].Username" type="string">
    TURN authentication username.
  </Property>
  <Property name="Turns[].Password" type="string">
    TURN authentication password.
  </Property>
  <Property name="CredentialsTTL" type="string">
    Time-to-live for TURN credentials. Format: Go duration (e.g., `12h`, `30m`). Default: `12h`
  </Property>
  <Property name="Secret" type="string">
    Shared secret for time-based credentials (when enabled).
  </Property>
  <Property name="TimeBasedCredentials" type="boolean">
    Enable time-based TURN credentials. Default: `false`
  </Property>
</Properties>

### Relay Section

Configures the NetBird relay server connection.

```json
"Relay": {
    "Addresses": ["rel://netbird.example.com:33080"],
    "CredentialsTTL": "24h",
    "Secret": "your-relay-secret"
}
```

<Properties>
  <Property name="Addresses" type="array">
    Array of relay server addresses. Format: `rel://hostname:port`
  </Property>
  <Property name="CredentialsTTL" type="string">
    Time-to-live for relay credentials. Default: `24h`
  </Property>
  <Property name="Secret" type="string">
    Shared authentication secret. Must match relay server's `NB_AUTH_SECRET`.
  </Property>
</Properties>

<Warning>
The relay secret must be identical in both `management.json` and the relay service environment. A mismatch will cause relay connections to fail.
</Warning>

### Signal Section

Configures the connection to the Signal service.

```json
"Signal": {
    "Proto": "http",
    "URI": "netbird.example.com:10000",
    "Username": "",
    "Password": null
}
```

<Properties>
  <Property name="Proto" type="string">
    Protocol for signal communication. Options: `http`, `https`. Default: `http` (internal), `https` (external).
  </Property>
  <Property name="URI" type="string">
    Signal server address. Format: `hostname:port`
  </Property>
  <Property name="Username" type="string">
    Optional authentication username. Usually empty.
  </Property>
  <Property name="Password" type="string | null">
    Optional authentication password. Usually `null`.
  </Property>
</Properties>

### ReverseProxy Section

Configures trusted reverse proxies for proper client IP detection.

```json
"ReverseProxy": {
    "TrustedHTTPProxies": [],
    "TrustedHTTPProxiesCount": 0,
    "TrustedPeers": ["0.0.0.0/0"]
}
```

<Properties>
  <Property name="TrustedHTTPProxies" type="array">
    List of trusted proxy IP addresses or CIDR ranges.
  </Property>
  <Property name="TrustedHTTPProxiesCount" type="number">
    Number of trusted proxy hops. Used with X-Forwarded-For header parsing.
  </Property>
  <Property name="TrustedPeers" type="array">
    CIDR ranges of trusted peers. Default: `["0.0.0.0/0"]` (trust all).
  </Property>
</Properties>

<Note>
When running behind a reverse proxy, configure `TrustedHTTPProxies` with your proxy's IP to ensure accurate client IP logging and rate limiting.
</Note>

### StoreConfig Section

Configures the database backend.

```json
"StoreConfig": {
    "Engine": "sqlite"
}
```

<Properties>
  <Property name="Engine" type="string">
    Database engine. Options: `sqlite`, `postgres`, `mysql`. Default: `sqlite`
  </Property>
</Properties>

For PostgreSQL or MySQL, set the connection string via environment variables:
- `NETBIRD_STORE_ENGINE_POSTGRES_DSN` for PostgreSQL
- `NETBIRD_STORE_ENGINE_MYSQL_DSN` for MySQL

See [Management Postgres Store](/selfhosted/postgres-store) for PostgreSQL setup.

### HttpConfig Section

Configures the HTTP API server and authentication.

```json
"HttpConfig": {
    "Address": "0.0.0.0:33073",
    "AuthIssuer": "https://netbird.example.com/oauth2",
    "AuthAudience": "netbird-dashboard",
    "AuthKeysLocation": "https://netbird.example.com/oauth2/keys",
    "AuthUserIDClaim": "",
    "CertFile": "/etc/letsencrypt/live/netbird.example.com/fullchain.pem",
    "CertKey": "/etc/letsencrypt/live/netbird.example.com/privkey.pem",
    "IdpSignKeyRefreshEnabled": false,
    "OIDCConfigEndpoint": "https://netbird.example.com/oauth2/.well-known/openid-configuration"
}
```

<Properties>
  <Property name="Address" type="string">
    Listen address for HTTP API. Format: `host:port`. Default: `0.0.0.0:33073`
  </Property>
  <Property name="AuthIssuer" type="string">
    OAuth2 token issuer URL for validation.
  </Property>
  <Property name="AuthAudience" type="string">
    Expected audience claim in JWT tokens.
  </Property>
  <Property name="AuthKeysLocation" type="string">
    URL to fetch JWT signing keys (JWKS endpoint).
  </Property>
  <Property name="AuthUserIDClaim" type="string">
    JWT claim to use as user ID. Empty uses `sub` claim.
  </Property>
  <Property name="CertFile" type="string">
    Path to TLS certificate file.
  </Property>
  <Property name="CertKey" type="string">
    Path to TLS certificate key file.
  </Property>
  <Property name="IdpSignKeyRefreshEnabled" type="boolean">
    Enable automatic JWKS key refresh. Default: `false`
  </Property>
  <Property name="OIDCConfigEndpoint" type="string">
    OIDC discovery endpoint URL.
  </Property>
</Properties>

### IdpManagerConfig Section

Configures the Identity Provider manager for user information retrieval.

```json
"IdpManagerConfig": {
    "ManagerType": "none",
    "ClientConfig": {
        "Issuer": "https://netbird.example.com/oauth2",
        "TokenEndpoint": "https://netbird.example.com/oauth2/token",
        "ClientID": "netbird-mgmt",
        "ClientSecret": "your-client-secret",
        "GrantType": "client_credentials"
    },
    "ExtraConfig": {}
}
```

<Properties>
  <Property name="ManagerType" type="string">
    IdP type. Options: `none`, `auth0`, `azure`, `keycloak`, `zitadel`, `google`, `okta`, `jumpcloud`
  </Property>
  <Property name="ClientConfig.Issuer" type="string">
    OAuth2 issuer URL.
  </Property>
  <Property name="ClientConfig.TokenEndpoint" type="string">
    OAuth2 token endpoint URL.
  </Property>
  <Property name="ClientConfig.ClientID" type="string">
    Client ID for machine-to-machine authentication.
  </Property>
  <Property name="ClientConfig.ClientSecret" type="string">
    Client secret for machine-to-machine authentication.
  </Property>
  <Property name="ClientConfig.GrantType" type="string">
    OAuth2 grant type. Usually `client_credentials`.
  </Property>
  <Property name="ExtraConfig" type="object">
    Provider-specific additional configuration.
  </Property>
</Properties>

### DeviceAuthorizationFlow Section

Configures device authorization flow for CLI authentication.

```json
"DeviceAuthorizationFlow": {
    "Provider": "none",
    "ProviderConfig": {
        "Audience": "netbird-dashboard",
        "ClientID": "netbird-client",
        "TokenEndpoint": "https://netbird.example.com/oauth2/token",
        "DeviceAuthEndpoint": "https://netbird.example.com/oauth2/device/authorize",
        "Scope": "openid",
        "UseIDToken": false
    }
}
```

<Properties>
  <Property name="Provider" type="string">
    Device auth provider. Options: `none`, `hosted`, `auth0`, `azure`, `keycloak`, `zitadel`, `okta`
  </Property>
  <Property name="ProviderConfig.Audience" type="string">
    OAuth2 audience for device tokens.
  </Property>
  <Property name="ProviderConfig.ClientID" type="string">
    Client ID for device authorization.
  </Property>
  <Property name="ProviderConfig.TokenEndpoint" type="string">
    Token exchange endpoint.
  </Property>
  <Property name="ProviderConfig.DeviceAuthEndpoint" type="string">
    Device authorization initiation endpoint.
  </Property>
  <Property name="ProviderConfig.Scope" type="string">
    OAuth2 scopes to request.
  </Property>
  <Property name="ProviderConfig.UseIDToken" type="boolean">
    Use ID token instead of access token. Default: `false`
  </Property>
</Properties>

### PKCEAuthorizationFlow Section

Configures PKCE authorization flow for browser-based authentication.

```json
"PKCEAuthorizationFlow": {
    "ProviderConfig": {
        "Audience": "netbird-dashboard",
        "ClientID": "netbird-dashboard",
        "ClientSecret": "",
        "AuthorizationEndpoint": "https://netbird.example.com/oauth2/authorize",
        "TokenEndpoint": "https://netbird.example.com/oauth2/token",
        "Scope": "openid profile email groups",
        "RedirectURLs": ["http://localhost:53000"],
        "UseIDToken": false,
        "DisablePromptLogin": false,
        "LoginFlag": 0
    }
}
```

<Properties>
  <Property name="ProviderConfig.Audience" type="string">
    OAuth2 audience for PKCE tokens.
  </Property>
  <Property name="ProviderConfig.ClientID" type="string">
    Public client ID for PKCE flow.
  </Property>
  <Property name="ProviderConfig.ClientSecret" type="string">
    Optional client secret. Usually empty for public clients.
  </Property>
  <Property name="ProviderConfig.AuthorizationEndpoint" type="string">
    Authorization endpoint URL.
  </Property>
  <Property name="ProviderConfig.TokenEndpoint" type="string">
    Token endpoint URL.
  </Property>
  <Property name="ProviderConfig.Scope" type="string">
    OAuth2 scopes to request.
  </Property>
  <Property name="ProviderConfig.RedirectURLs" type="array">
    Allowed redirect URLs for PKCE flow.
  </Property>
  <Property name="ProviderConfig.UseIDToken" type="boolean">
    Use ID token instead of access token. Default: `false`
  </Property>
  <Property name="ProviderConfig.DisablePromptLogin" type="boolean">
    Skip login prompt for returning users. Default: `false`
  </Property>
  <Property name="ProviderConfig.LoginFlag" type="number">
    Login behavior flag. `0` = default, `1` = force login.
  </Property>
</Properties>

### Other Top-Level Settings

<Properties>
  <Property name="DisableDefaultPolicy" type="boolean">
    Disable the default "allow all" access policy for new accounts. Default: `false`
  </Property>
  <Property name="Datadir" type="string">
    Data directory path. Usually set via command line.
  </Property>
  <Property name="DataStoreEncryptionKey" type="string">
    32-byte encryption key for sensitive data at rest. Auto-generated by setup scripts.
  </Property>
</Properties>

<Warning>
Keep `DataStoreEncryptionKey` secure and backed up. Losing this key means losing access to encrypted data in the database.
</Warning>

---

## relay.env

Environment configuration for the relay service. This file is mounted into the relay container.

```bash
# Log level: debug, info, warn, error
NB_LOG_LEVEL=info

# Address to listen on
NB_LISTEN_ADDRESS=:33080

# Public address for peers to connect
NB_EXPOSED_ADDRESS=rel://netbird.example.com:33080

# Authentication secret (must match management.json Relay.Secret)
NB_AUTH_SECRET=your-secret-here
```

### All Relay Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `NB_LOG_LEVEL` | `info` | Log verbosity |
| `NB_LISTEN_ADDRESS` | `:33080` | Listen address |
| `NB_EXPOSED_ADDRESS` | - | Public relay address for peers |
| `NB_AUTH_SECRET` | - | Shared authentication secret |
| `NB_METRICS_PORT` | - | Prometheus metrics port (optional) |
| `NB_TLS_CERT_FILE` | - | TLS certificate file path |
| `NB_TLS_KEY_FILE` | - | TLS key file path |
| `NB_LETSENCRYPT_DATA_DIR` | - | Let's Encrypt data directory |
| `NB_LETSENCRYPT_DOMAINS` | - | Domains for Let's Encrypt |
| `NB_LETSENCRYPT_EMAIL` | - | Let's Encrypt email |
| `NB_HEALTH_LISTEN_ADDRESS` | - | Health check endpoint address |

---

## dashboard.env

Environment configuration for the dashboard service.

```bash
# Endpoints
NETBIRD_MGMT_API_ENDPOINT=https://netbird.example.com
NETBIRD_MGMT_GRPC_API_ENDPOINT=https://netbird.example.com

# OIDC - using embedded IdP
AUTH_AUDIENCE=netbird-dashboard
AUTH_CLIENT_ID=netbird-dashboard
AUTH_CLIENT_SECRET=
AUTH_AUTHORITY=https://netbird.example.com/oauth2
USE_AUTH0=false
AUTH_SUPPORTED_SCOPES=openid profile email groups
AUTH_REDIRECT_URI=/nb-auth
AUTH_SILENT_REDIRECT_URI=/nb-silent-auth

# SSL
NGINX_SSL_PORT=443

# Letsencrypt
LETSENCRYPT_DOMAIN=netbird.example.com
LETSENCRYPT_EMAIL=admin@example.com
```

### Endpoint Configuration

| Variable | Description |
|----------|-------------|
| `NETBIRD_MGMT_API_ENDPOINT` | Management REST API endpoint URL |
| `NETBIRD_MGMT_GRPC_API_ENDPOINT` | Management gRPC endpoint URL |

### Authentication Configuration

| Variable | Description |
|----------|-------------|
| `AUTH_AUDIENCE` | OAuth2 audience claim |
| `AUTH_CLIENT_ID` | OAuth2 client ID |
| `AUTH_CLIENT_SECRET` | OAuth2 client secret (empty for public clients) |
| `AUTH_AUTHORITY` | OAuth2 issuer URL |
| `USE_AUTH0` | Set to `true` when using Auth0 |
| `AUTH_SUPPORTED_SCOPES` | Space-separated OAuth2 scopes |
| `AUTH_REDIRECT_URI` | OAuth2 redirect path |
| `AUTH_SILENT_REDIRECT_URI` | Silent auth redirect path |

### SSL/TLS Configuration

| Variable | Default | Description |
|----------|---------|-------------|
| `NGINX_SSL_PORT` | `443` | HTTPS port |
| `LETSENCRYPT_DOMAIN` | - | Domain for Let's Encrypt (set to `none` to disable) |
| `LETSENCRYPT_EMAIL` | - | Email for Let's Encrypt |

---

## turnserver.conf

Coturn TURN server configuration.

```ini
# Listening ports
listening-port=3478
tls-listening-port=5349

# TURN relay port range
min-port=49152
max-port=65535

# Authentication
lt-cred-mech
user=netbird:your-turn-password

# Domain/Realm
realm=wiretrustee.com

# Logging
log-file=stdout

# Fingerprinting
fingerprint

# Disable TCP relay (optional, saves resources)
# no-tcp-relay
```

### Key Settings

| Setting | Default | Description |
|---------|---------|-------------|
| `listening-port` | `3478` | UDP/TCP STUN/TURN port |
| `tls-listening-port` | `5349` | TLS TURN port |
| `min-port` | `49152` | Minimum relay port |
| `max-port` | `65535` | Maximum relay port |
| `lt-cred-mech` | - | Enable long-term credential mechanism |
| `user` | - | TURN credentials in format `username:password` |
| `realm` | `wiretrustee.com` | TURN realm |
| `external-ip` | - | External IP for NAT (if behind NAT) |
| `fingerprint` | - | Enable STUN fingerprinting |

<Note>
If your server is behind NAT, you must configure `external-ip` with your public IP address for TURN to work correctly.
</Note>

---

## Common Configuration Scenarios

### Using an External Database

To use PostgreSQL instead of SQLite:

1. Update `management.json`:
```json
"StoreConfig": {
    "Engine": "postgres"
}
```

2. Set the connection string in `docker-compose.yml`:
```yaml
management:
  environment:
    - NETBIRD_STORE_ENGINE_POSTGRES_DSN=postgres://user:password@host:5432/netbird?sslmode=disable
```

See [Management Postgres Store](/selfhosted/postgres-store) for detailed setup.

### Disabling Anonymous Metrics

In `docker-compose.yml`, update the management command:

```yaml
management:
  command: [
    "--port", "443",
    "--disable-anonymous-metrics=true",
    # ... other flags
  ]
```

### Custom Relay Configuration

To use multiple relay servers, update `management.json`:

```json
"Relay": {
    "Addresses": [
        "rel://relay1.example.com:33080",
        "rel://relay2.example.com:33080"
    ],
    "CredentialsTTL": "24h",
    "Secret": "shared-secret"
}
```

Each relay server must use the same `NB_AUTH_SECRET`.

### Behind a Reverse Proxy

When running behind your own reverse proxy (Traefik, Nginx, etc.):

1. Set `LETSENCRYPT_DOMAIN=none` in `dashboard.env`
2. Configure trusted proxies in `management.json`:
```json
"ReverseProxy": {
    "TrustedHTTPProxies": ["10.0.0.1"],
    "TrustedHTTPProxiesCount": 1,
    "TrustedPeers": ["10.0.0.0/8"]
}
```

See [Reverse Proxy Configuration](/selfhosted/reverse-proxy) for detailed templates.

### Configuring External TURN Servers

To use external TURN servers (e.g., for geographically distributed deployments):

```json
"TURNConfig": {
    "Turns": [
        {
            "Proto": "udp",
            "URI": "turn:turn-us.example.com:3478",
            "Username": "netbird",
            "Password": "password1"
        },
        {
            "Proto": "udp",
            "URI": "turn:turn-eu.example.com:3478",
            "Username": "netbird",
            "Password": "password2"
        }
    ],
    "CredentialsTTL": "12h",
    "TimeBasedCredentials": false
}
```

---

## See Also

- [Self-hosting Quickstart Guide](/selfhosted/selfhosted-quickstart) - Get started quickly with default settings
- [Advanced Self-hosting Guide](/selfhosted/selfhosted-guide) - Custom IdP integration
- [Environment Variables](/selfhosted/environment-variables) - Runtime environment configuration
- [Reverse Proxy Configuration](/selfhosted/reverse-proxy) - Traefik, Nginx, Caddy setup
- [Management SQLite Store](/selfhosted/sqlite-store) - SQLite database details
- [Management Postgres Store](/selfhosted/postgres-store) - PostgreSQL setup
